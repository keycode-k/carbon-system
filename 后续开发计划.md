# 后续开发计划与建议

## 当前进度 (2026-01-07 更新)

### ✅ 已完成功能
1. **基础架构** ✅
   - 微服务架构搭建完成（5个服务 + carbon-common公共模块）
   - Nacos 服务注册与发现
   - 前后端分离架构（Vue 3 + Spring Cloud）

2. **用户体系** ✅
   - 用户注册、登录、信息管理
   - Token 认证（Redis存储）
   - 前后端完整对接

3. **企业认证** ✅ **NEW**
   - 企业信息管理（CompanyInfo表）
   - 认证申请与审核流程
   - 前端完整认证页面（提交/审核中/已认证/已驳回）

4. **碳资产管理** ✅
   - **碳配额 (Quota)**: 完整CRUD，配额明细查询
   - **碳信用 (CCER)**: 列表查询、详情展示
   - 前端数据展示与交互完善

5. **碳交易市场** ✅
   - 交易订单系统（TradeOrder表）
   - 市场挂单、发布订单接口
   - 前端行情展示与交易所页面

6. **碳资产开发** ✅
   - **项目管理**: 项目列表、创建项目
   - **方法学管理**: ✅ **NEW** 完整CRUD（8个接口）
     - 分页查询、筛选、新增、编辑、删除
     - 前端完整实现（搜索、表格、弹窗）
     - 7条测试数据

7. **架构优化** ✅
   - carbon-common 公共模块统一 Result 类
   - 数据库连接池优化（HikariCP配置）
   - 前端代理路由优化
   - 代码规范统一

### 📊 完成度统计
- **功能完成度**: 65% (较上次+15%)
- **数据库表**: 8张（已完成）
- **后端接口**: 50+ REST API
- **前端页面**: 17个页面
- **API封装**: 4个文件，30+函数

## 后续开发路线图

### 第一阶段：短期优化（1周内）

#### 1.1 交易模块完善 ⭐⭐⭐
**目标**: 完善交易相关功能，提升用户体验

**具体任务**:
- [ ] 创建 `trade.js` API封装文件
  - 封装交易订单相关接口
  - 统一交易市场前端调用
  
- [ ] **询报价功能**
  - 后端: 新增 `QuoteOrder` 表和 `QuoteController`（可放在 service-trade）
  - 字段: id, userId, type(买入/卖出), assetType, quantity, price, status, createTime
  - 接口: 发布询价、报价、查询询价单列表
  - 前端: 完善 `market/quotes.vue` 页面

- [ ] **交易账户管理**
  - 后端: 新增 `TradeAccount` 表（可放在 service-trade 或独立 service-account）
  - 字段: id, userId, balance(资金余额), frozenAmount(冻结金额), totalAssets(总资产), createTime, updateTime
  - 接口: 查询账户、充值、提现、资金流水
  - 前端: 完善 `market/account.vue` 资金和持仓展示

**预期成果**: 交易模块功能完整，用户可以完整体验交易流程

---

#### 1.2 首页仪表盘优化 ⭐⭐
**目标**: 实现数据聚合展示，提供系统全局视图

**具体任务**:
- [ ] 后端聚合接口（可放在 service-consumer）
  - GET `/api/dashboard/summary` - 汇总统计数据
  - 返回: 用户总数、企业认证数、碳资产总量、交易总额、待办事项数
  
- [ ] 前端 `dashboard/index.vue` 数据对接
  - 使用 ECharts 图表展示趋势
  - 卡片展示关键指标
  - 实时刷新机制

**预期成果**: 首页数据展示完整，用户一目了然

---

### 第二阶段：功能补充（2-3周）

#### 2.1 碳资讯模块 ⭐⭐
**目标**: 提供行业资讯和政策信息发布平台

**具体任务**:
- [ ] 后端实现（建议放在 service-provider）
  - 新增 `News` 表
  - 字段: id, title, content, category, author, publishTime, viewCount, status, coverImage
  - 接口: 
    - GET `/api/news/list` - 分页查询新闻列表
    - GET `/api/news/{id}` - 查询新闻详情
    - POST `/api/news` - 发布新闻（管理员）
    - PUT `/api/news/{id}` - 更新新闻
    - DELETE `/api/news/{id}` - 删除新闻
  
- [ ] 前端实现
  - 完善 `news/index.vue` 新闻列表页
  - 新增新闻详情页（可使用 Markdown 渲染）
  - 分类筛选、搜索功能
  - 管理员发布界面

**预期成果**: 资讯模块上线，支持内容发布和浏览

---

#### 2.2 开发工作台完善 ⭐⭐⭐
**目标**: 实现项目文档管理和开发进度跟踪

**具体任务**:
- [ ] 后端实现（service-development）
  - 新增 `ProjectDocument` 表
  - 字段: id, projectId, documentName, documentType(PDD/监测报告/签发证书), fileUrl, uploadTime, uploader, status
  - 接口:
    - GET `/api/development/documents/list` - 查询项目文档列表
    - POST `/api/development/documents/upload` - 上传文档
    - GET `/api/development/documents/{id}/download` - 下载文档
    - DELETE `/api/development/documents/{id}` - 删除文档
  
  - 新增 `ProjectProgress` 表（可选）
  - 字段: id, projectId, stage(立项/审批/实施/监测/签发), status, startTime, endTime, remark
  
- [ ] 前端实现
  - 完善 `development/workbench.vue`
  - 集成文件上传组件（Element Plus el-upload）
  - 项目进度时间轴展示
  - 文档列表和预览

**预期成果**: 开发工作台功能完善，支持全流程文档管理

---

### 第三阶段：系统管理（1个月）

#### 3.1 权限管理 ⭐⭐⭐⭐
**目标**: 实现基于角色的访问控制（RBAC）

**具体任务**:
- [ ] 数据库设计（service-provider）
  - `role` 表: id, roleName, roleKey, description
  - `permission` 表: id, permissionName, permissionKey, resourceType
  - `user_role` 表: userId, roleId
  - `role_permission` 表: roleId, permissionId
  
- [ ] 后端实现
  - RoleController, PermissionController
  - 权限验证拦截器
  - 注解式权限控制 `@RequiresPermission("system:user:add")`
  
- [ ] 前端实现
  - `system/role.vue` - 角色管理页面
  - `system/permission.vue` - 权限管理页面
  - 按钮级权限控制（v-if 指令）

**预期成果**: 完整的权限体系，支持细粒度权限控制

---

#### 3.2 审批流程 ⭐⭐⭐⭐
**目标**: 实现业务流程审批管理

**具体任务**:
- [ ] 技术选型
  - 方案1: 自研轻量级审批流（推荐初期）
  - 方案2: 集成 Flowable/Activiti 工作流引擎
  
- [ ] 自研方案实现（service-provider）
  - `workflow_definition` 表: 流程定义
  - `workflow_instance` 表: 流程实例
  - `workflow_task` 表: 审批任务
  - `workflow_history` 表: 审批历史
  
- [ ] 业务集成
  - 企业认证审批
  - 项目立项审批
  - 资产交易审批（大额）
  
- [ ] 前端实现
  - `system/approval.vue` - 审批列表页
  - 待办任务、已办任务、审批详情
  - 审批通过/驳回操作

**预期成果**: 核心业务支持审批流程，提升规范性

---

### 第四阶段：架构升级（长期）

#### 4.1 统一认证服务 ⭐⭐⭐⭐⭐
**目标**: 实现微服务统一认证和单点登录

**具体任务**:
- [ ] 技术选型
  - Spring Security + OAuth2 + JWT
  - 或 Spring Cloud Gateway + JWT
  
- [ ] 架构调整
  - 独立认证服务 carbon-auth（可选）
  - 或在 service-provider 中集成
  
- [ ] 功能实现
  - JWT Token 生成和验证
  - Refresh Token 机制
  - 登录日志记录
  - 多设备登录控制

**预期成果**: 统一的认证体系，提升安全性

---

#### 4.2 运维监控 ⭐⭐⭐
**目标**: 实现生产级监控和运维能力

**具体任务**:
- [ ] 服务监控
  - Spring Boot Admin（服务健康检查）
  - Actuator 端点暴露
  
- [ ] 日志收集
  - ELK Stack（Elasticsearch + Logstash + Kibana）
  - 或 Loki + Grafana
  
- [ ] 性能监控
  - Prometheus + Grafana
  - JVM 监控、接口性能分析
  
- [ ] 链路追踪
  - Zipkin 或 SkyWalking
  - 分布式调用链追踪

**预期成果**: 完善的监控体系，快速定位问题

---

#### 4.3 容器化部署 ⭐⭐⭐⭐
**目标**: 实现 Docker 容器化和自动化部署

**具体任务**:
- [ ] Docker 化
  - 为每个服务编写 Dockerfile
  - Docker Compose 编排本地环境
  
- [ ] CI/CD
  - Jenkins 或 GitLab CI
  - 自动构建、测试、部署
  
- [ ] Kubernetes（可选）
  - K8s 集群部署
  - 服务编排和自动扩缩容

**预期成果**: 自动化部署流程，提升运维效率

---

## 技术债务清单

### 高优先级
- [ ] ~~配置文件敏感信息迁移到 Nacos~~ → 建议使用环境变量或 Vault
- [ ] 统一异常处理机制（全局异常拦截器）
- [ ] 接口参数校验（JSR-303 Bean Validation）
- [ ] 接口文档（Swagger/Knife4j 或 OpenAPI）

### 中优先级
- [ ] 单元测试覆盖（JUnit 5 + Mockito）
- [ ] 接口性能优化（数据库索引、缓存策略）
- [ ] 前端状态管理优化（Pinia）
- [ ] 前端错误边界和加载状态

### 低优先级
- [ ] 代码注释完善
- [ ] 数据库迁移工具（Flyway/Liquibase）
- [ ] 国际化支持（i18n）
- [ ] 移动端适配

---

## 模块独立性建议

为保证新功能不过度割裂，建议遵循以下原则：

### 1. 服务拆分原则
- **按业务领域拆分**: 每个服务负责一个完整的业务领域
- **共享数据最小化**: 服务间通过 API 调用，避免直接访问数据库
- **公共模块复用**: carbon-common 存放公共类和工具

### 2. 推荐服务划分
```
当前服务                  建议新增服务
├── service-consumer  →  保持不变（API网关）
├── service-provider  →  拆分为 service-system（系统管理）
├── service-assets    →  保持不变（碳资产）
├── service-trade     →  扩展为 service-trade + service-account（账户）
├── service-development → 保持不变（开发）
└── 新增:
    ├── service-news（资讯模块，或合并到 service-provider）
    ├── service-workflow（审批流，或合并到 service-provider）
    └── service-auth（认证服务，可选独立）
```

### 3. 数据隔离与共享
- **完全隔离**: 各服务独立数据库（理想状态）
- **逻辑隔离**: 共享数据库，但表前缀区分（当前实践）
- **共享数据**: user 表等基础数据可适当共享

---

## 开发优先级矩阵

| 功能 | 业务价值 | 开发难度 | 优先级 | 预计工期 |
|-----|---------|---------|--------|---------|
| 交易账户管理 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | P0 | 3天 |
| 询报价功能 | ⭐⭐⭐⭐ | ⭐⭐ | P0 | 2天 |
| 首页仪表盘 | ⭐⭐⭐⭐ | ⭐⭐ | P1 | 2天 |
| 碳资讯模块 | ⭐⭐⭐ | ⭐⭐ | P1 | 3天 |
| 开发工作台文档 | ⭐⭐⭐⭐ | ⭐⭐⭐ | P1 | 4天 |
| 权限管理 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | P1 | 1周 |
| 审批流程 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | P2 | 2周 |
| 统一认证 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | P2 | 1周 |
| 运维监控 | ⭐⭐⭐ | ⭐⭐⭐⭐ | P3 | 1周 |
| 容器化部署 | ⭐⭐⭐ | ⭐⭐⭐⭐ | P3 | 1周 |

**优先级说明**:
- **P0**: 本周必须完成（核心功能补充）
- **P1**: 2-3周内完成（重要功能）
- **P2**: 1个月内完成（架构升级）
- **P3**: 长期规划（运维优化）

---

## 总结
