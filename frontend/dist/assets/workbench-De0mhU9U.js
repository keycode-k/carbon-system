import{s as B,_ as te,u as oe,r as w,k as x,O as le,m as ne,c as D,d as t,w as l,f as s,t as se,o as y,b as a,W as ae,X as re,n as ie,v as u,e as r,q as de,h as $,E as p,L as I}from"./index-Dl24hcOp.js";function ce(_){return B({url:`/api/development/document/download/${_}`,method:"get"})}function ue(_){return B({url:`/api/development/document/${_}`,method:"delete"})}function pe(_){return B({url:`/api/development/document/project/${_}`,method:"get"})}const _e={class:"app-container"},me={class:"clearfix"},fe={class:"project-list"},ve=["onClick"],he={class:"p-title"},we={class:"p-info"},ye={class:"p-date"},ge={class:"detail-header"},ke={class:"step-container"},be={class:"task-content"},xe={class:"document-list"},De={key:1},Be={__name:"workbench",setup(_){const P=oe(),d=w(0),C=w(5e4),v=[{id:1,name:"内蒙古 100MW 风电并网项目",type:"风电",date:"2025-10-01",step:1},{id:2,name:"广东某造纸厂生物质锅炉改造",type:"节能提效",date:"2025-09-15",step:3},{id:3,name:"福建沿海红树林修复工程",type:"林业碳汇",date:"2025-08-20",step:2}],E=w([]),g=w(!1),j=w([]),L=x(()=>"http://localhost:8083/api/development/document/upload"),S=x(()=>({Authorization:`Bearer ${localStorage.getItem("token")}`})),z=x(()=>({projectId:v[d.value].id,docName:"",docType:"PDD设计文件",uploadUserId:P.userId||1})),h=async()=>{g.value=!0;try{const o=v[d.value].id,e=await pe(o);e&&(E.value=e)}catch(o){console.error("加载文档列表失败:",o)}finally{g.value=!1}},N=o=>o.size/1024/1024<50?(z.value.docName=o.name,!0):(p.error("上传文件大小不能超过 50MB!"),!1),U=(o,e,i)=>{o.code===200||o.success?(p.success("文档上传成功"),h()):p.error(o.message||"上传失败")},R=(o,e,i)=>{p.error("文档上传失败"),console.error(o)},F=async o=>{try{const e=await ce(o.id);e&&p.success(`文件路径: ${e}`)}catch(e){console.error("下载失败:",e)}},O=o=>{I.prompt("请输入新版本号","创建版本",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^v\d+\.\d+$/,inputErrorMessage:"版本号格式错误，如: v1.1"}).then(({value:e})=>{p.success(`创建版本 ${e} 成功`),h()}).catch(()=>{})},A=o=>{I.confirm("确定要删除该文档吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ue(o.id),p.success("删除成功"),h()}catch(e){console.error("删除失败:",e)}}).catch(()=>{})},W=o=>o?o<1024?o+" B":o<1024*1024?(o/1024).toFixed(2)+" KB":(o/1024/1024).toFixed(2)+" MB":"-",G=o=>({DRAFT:"草稿",REVIEWING:"审核中",APPROVED:"已批准"})[o]||o;return le(d,()=>{h()}),ne(()=>{h()}),(o,e)=>{const i=s("el-button"),k=s("el-tag"),M=s("el-card"),T=s("el-col"),m=s("el-step"),q=s("el-steps"),V=s("el-divider"),H=s("el-alert"),K=s("el-input"),b=s("el-form-item"),X=s("el-input-number"),J=s("el-upload"),Q=s("el-form"),c=s("el-table-column"),Y=s("el-table"),Z=s("el-row"),ee=se("loading");return y(),D("div",_e,[t(Z,{gutter:20},{default:l(()=>[t(T,{span:6},{default:l(()=>[t(M,{shadow:"never",class:"project-list-card"},{header:l(()=>[a("div",me,[e[2]||(e[2]=a("span",null,"进行中的项目",-1)),t(i,{style:{float:"right",padding:"3px 0"},link:"",type:"primary"},{default:l(()=>[...e[1]||(e[1]=[r("新建",-1)])]),_:1})])]),default:l(()=>[a("div",fe,[(y(),D(ae,null,re(v,(n,f)=>a("div",{key:f,class:ie(["project-item",{active:d.value===f}]),onClick:Ce=>d.value=f},[a("div",he,u(n.name),1),a("div",we,[t(k,{size:"small"},{default:l(()=>[r(u(n.type),1)]),_:2},1024),a("span",ye,u(n.date),1)])],10,ve)),64))])]),_:1})]),_:1}),t(T,{span:18},{default:l(()=>[t(M,{shadow:"hover"},{header:l(()=>[a("div",ge,[a("h3",null,u(v[d.value].name),1),t(i,{type:"primary",size:"small"},{default:l(()=>[...e[3]||(e[3]=[r("保存进度",-1)])]),_:1})])]),default:l(()=>[a("div",ke,[t(q,{active:v[d.value].step,"finish-status":"success","align-center":""},{default:l(()=>[t(m,{title:"立项",description:"提交项目建议书"}),t(m,{title:"PDD设计",description:"编写项目设计文件"}),t(m,{title:"第三方审定",description:"DOE 现场审定"}),t(m,{title:"主管部门备案",description:"发改委/生态部备案"}),t(m,{title:"减排量核证",description:"监测与核证"}),t(m,{title:"资产签发",description:"CCER 上市"})]),_:1},8,["active"])]),t(V),a("div",be,[e[10]||(e[10]=a("h4",null,"当前阶段任务：PDD 文件编写",-1)),t(H,{title:"请依据 CM-001-V01 方法学进行测算",type:"info","show-icon":"",style:{"margin-bottom":"20px"}}),t(Q,{"label-position":"top"},{default:l(()=>[t(b,{label:"项目基准线描述"},{default:l(()=>[t(K,{type:"textarea",rows:4,placeholder:"请输入..."})]),_:1}),t(b,{label:"预计年减排量 (tCO2e)"},{default:l(()=>[t(X,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=n=>C.value=n),min:0},null,8,["modelValue"])]),_:1}),t(b,{label:"文档上传"},{default:l(()=>[t(J,{action:L.value,headers:S.value,data:z.value,"before-upload":N,"on-success":U,"on-error":R,multiple:"",limit:10,"file-list":j.value},{tip:l(()=>[...e[5]||(e[5]=[a("div",{class:"el-upload__tip"}," 支持 pdf、doc、docx、xls、xlsx 等格式，单个文件不超过50MB ",-1)])]),default:l(()=>[t(i,{type:"primary"},{default:l(()=>[...e[4]||(e[4]=[r("点击上传文档",-1)])]),_:1})]),_:1},8,["action","headers","data","file-list"])]),_:1})]),_:1}),t(V),a("div",xe,[e[9]||(e[9]=a("h4",null,"项目文档列表",-1)),de((y(),$(Y,{data:E.value,border:"",stripe:""},{default:l(()=>[t(c,{prop:"docName",label:"文档名称","min-width":"200"}),t(c,{prop:"docType",label:"文档类型",width:"120"},{default:l(n=>[n.row.docType?(y(),$(k,{key:0,size:"small"},{default:l(()=>[r(u(n.row.docType),1)]),_:2},1024)):(y(),D("span",De,"-"))]),_:1}),t(c,{prop:"version",label:"版本",width:"100"}),t(c,{prop:"status",label:"状态",width:"100"},{default:l(n=>[t(k,{type:n.row.status==="APPROVED"?"success":n.row.status==="REVIEWING"?"warning":"info",size:"small"},{default:l(()=>[r(u(G(n.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"fileSize",label:"文件大小",width:"120"},{default:l(n=>[r(u(W(n.row.fileSize)),1)]),_:1}),t(c,{prop:"createTime",label:"上传时间",width:"160"}),t(c,{label:"操作",width:"200",fixed:"right"},{default:l(n=>[t(i,{link:"",type:"primary",size:"small",onClick:f=>F(n.row)},{default:l(()=>[...e[6]||(e[6]=[r("下载",-1)])]),_:1},8,["onClick"]),t(i,{link:"",type:"primary",size:"small",onClick:f=>O(n.row)},{default:l(()=>[...e[7]||(e[7]=[r("版本",-1)])]),_:1},8,["onClick"]),t(i,{link:"",type:"danger",size:"small",onClick:f=>A(n.row)},{default:l(()=>[...e[8]||(e[8]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,g.value]])])])]),_:1})]),_:1})]),_:1})])}}},ze=te(Be,[["__scopeId","data-v-756d5eff"]]);export{ze as default};
