import{s as L,_ as oe,a as B,r as y,m as ne,c as se,d as e,w as t,f as r,t as re,o as c,q as ue,b as A,x as k,U as de,e as s,$ as ie,a7 as pe,aa as me,h as b,v as d,a3 as fe,N as T,E as G,L as ce}from"./index-Dl24hcOp.js";function _e(g){return L({url:"/api/system/log/list",method:"get",params:g})}function ve(g){return L({url:`/api/system/log/${g}`,method:"get"})}function ye(g){return L({url:"/api/system/log/clean",method:"delete",params:{days:g}})}const be={class:"app-container"},ge={class:"pagination-container"},we={__name:"operation",setup(g){const n=B({username:"",module:"",operationType:"",status:null,startTime:"",endTime:"",page:1,size:10}),_=y([]),P=y([]),D=y(0),O=y(!1),V=y(!1),o=y({}),x=y(!1),E=B({days:30}),M={CREATE:{name:"新增",color:"success"},UPDATE:{name:"修改",color:"primary"},DELETE:{name:"删除",color:"danger"},QUERY:{name:"查询",color:"info"},LOGIN:{name:"登录",color:"warning"},LOGOUT:{name:"登出",color:"info"},EXPORT:{name:"导出",color:""},IMPORT:{name:"导入",color:""},OTHER:{name:"其他",color:"info"}},z=u=>M[u]?.name||u,q=u=>M[u]?.color||"info",w=async()=>{O.value=!0;try{_.value&&_.value.length===2?(n.startTime=_.value[0],n.endTime=_.value[1]):(n.startTime="",n.endTime="");const u=await _e(n);u.code===200&&(P.value=u.data.records||[],D.value=u.data.total||0)}catch(u){console.error("获取日志列表失败:",u)}finally{O.value=!1}},Q=()=>{n.page=1,w()},h=()=>{n.username="",n.module="",n.operationType="",n.status=null,n.startTime="",n.endTime="",_.value=[],n.page=1,w()},S=async u=>{try{const l=await ve(u.id);l.code===200&&(o.value=l.data,V.value=!0)}catch{o.value=u,V.value=!0}},H=()=>{x.value=!0},X=async()=>{try{await ce.confirm(`确定要删除 ${E.days} 天前的操作日志吗？此操作不可恢复！`,"警告",{type:"warning"}),(await ye(E.days)).code===200&&(G.success("清理成功"),x.value=!1,w())}catch(u){u!=="cancel"&&console.error("清理日志失败:",u)}},j=()=>{G.info("导出功能开发中...")};return ne(()=>{w()}),(u,l)=>{const U=r("el-input"),v=r("el-form-item"),m=r("el-option"),I=r("el-select"),F=r("el-date-picker"),f=r("el-button"),N=r("el-form"),Y=r("el-col"),J=r("el-row"),p=r("el-table-column"),C=r("el-tag"),K=r("el-table"),W=r("el-pagination"),Z=r("el-card"),i=r("el-descriptions-item"),ee=r("el-descriptions"),R=r("el-divider"),le=r("el-alert"),$=r("el-dialog"),te=r("el-input-number"),ae=re("loading");return c(),se("div",be,[e(Z,{shadow:"never"},{default:t(()=>[e(N,{inline:!0,model:n,class:"search-form"},{default:t(()=>[e(v,{label:"操作用户"},{default:t(()=>[e(U,{modelValue:n.username,"onUpdate:modelValue":l[0]||(l[0]=a=>n.username=a),placeholder:"请输入用户名",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(v,{label:"操作模块"},{default:t(()=>[e(U,{modelValue:n.module,"onUpdate:modelValue":l[1]||(l[1]=a=>n.module=a),placeholder:"请输入模块",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(v,{label:"操作类型"},{default:t(()=>[e(I,{modelValue:n.operationType,"onUpdate:modelValue":l[2]||(l[2]=a=>n.operationType=a),placeholder:"请选择",clearable:"",style:{width:"130px"}},{default:t(()=>[e(m,{label:"新增",value:"CREATE"}),e(m,{label:"修改",value:"UPDATE"}),e(m,{label:"删除",value:"DELETE"}),e(m,{label:"查询",value:"QUERY"}),e(m,{label:"登录",value:"LOGIN"}),e(m,{label:"登出",value:"LOGOUT"}),e(m,{label:"导出",value:"EXPORT"}),e(m,{label:"导入",value:"IMPORT"}),e(m,{label:"其他",value:"OTHER"})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"操作状态"},{default:t(()=>[e(I,{modelValue:n.status,"onUpdate:modelValue":l[3]||(l[3]=a=>n.status=a),placeholder:"请选择",clearable:"",style:{width:"100px"}},{default:t(()=>[e(m,{label:"成功",value:1}),e(m,{label:"失败",value:0})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"操作时间"},{default:t(()=>[e(F,{modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=a=>_.value=a),type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(v,null,{default:t(()=>[e(f,{type:"primary",icon:k(de),onClick:Q},{default:t(()=>[...l[14]||(l[14]=[s("搜索",-1)])]),_:1},8,["icon"]),e(f,{icon:k(ie),onClick:h},{default:t(()=>[...l[15]||(l[15]=[s("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),e(J,{gutter:10,class:"mb10"},{default:t(()=>[e(Y,{span:1.5},{default:t(()=>[e(f,{type:"danger",plain:"",icon:k(pe),onClick:H},{default:t(()=>[...l[16]||(l[16]=[s("清理日志",-1)])]),_:1},8,["icon"])]),_:1}),e(Y,{span:1.5},{default:t(()=>[e(f,{type:"warning",plain:"",icon:k(me),onClick:j},{default:t(()=>[...l[17]||(l[17]=[s("导出",-1)])]),_:1},8,["icon"])]),_:1})]),_:1}),ue((c(),b(K,{data:P.value,style:{width:"100%"}},{default:t(()=>[e(p,{type:"index",label:"序号",width:"60"}),e(p,{prop:"username",label:"操作用户",width:"100"}),e(p,{prop:"module",label:"操作模块",width:"120"}),e(p,{prop:"operationType",label:"操作类型",width:"90"},{default:t(({row:a})=>[e(C,{type:q(a.operationType)},{default:t(()=>[s(d(z(a.operationType)),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"description",label:"操作描述",width:"150","show-overflow-tooltip":""}),e(p,{prop:"requestUrl",label:"请求地址",width:"200","show-overflow-tooltip":""}),e(p,{prop:"ip",label:"操作IP",width:"130"}),e(p,{prop:"browser",label:"浏览器",width:"100","show-overflow-tooltip":""}),e(p,{prop:"status",label:"状态",width:"80"},{default:t(({row:a})=>[e(C,{type:a.status===1?"success":"danger"},{default:t(()=>[s(d(a.status===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"duration",label:"耗时(ms)",width:"90"}),e(p,{prop:"createTime",label:"操作时间",width:"170"}),e(p,{label:"操作",width:"100",fixed:"right"},{default:t(({row:a})=>[e(f,{type:"primary",link:"",icon:k(fe),onClick:Te=>S(a)},{default:t(()=>[...l[18]||(l[18]=[s("详情",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[ae,O.value]]),A("div",ge,[e(W,{"current-page":n.page,"onUpdate:currentPage":l[5]||(l[5]=a=>n.page=a),"page-size":n.size,"onUpdate:pageSize":l[6]||(l[6]=a=>n.size=a),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])])]),_:1}),e($,{modelValue:V.value,"onUpdate:modelValue":l[10]||(l[10]=a=>V.value=a),title:"操作日志详情",width:"700px"},{footer:t(()=>[e(f,{onClick:l[9]||(l[9]=a=>V.value=!1)},{default:t(()=>[...l[22]||(l[22]=[s("关闭",-1)])]),_:1})]),default:t(()=>[e(ee,{column:2,border:""},{default:t(()=>[e(i,{label:"日志ID"},{default:t(()=>[s(d(o.value.id),1)]),_:1}),e(i,{label:"操作用户"},{default:t(()=>[s(d(o.value.username),1)]),_:1}),e(i,{label:"操作模块"},{default:t(()=>[s(d(o.value.module),1)]),_:1}),e(i,{label:"操作类型"},{default:t(()=>[e(C,{type:q(o.value.operationType)},{default:t(()=>[s(d(z(o.value.operationType)),1)]),_:1},8,["type"])]),_:1}),e(i,{label:"操作描述",span:2},{default:t(()=>[s(d(o.value.description),1)]),_:1}),e(i,{label:"请求方法",span:2},{default:t(()=>[s(d(o.value.method),1)]),_:1}),e(i,{label:"请求地址",span:2},{default:t(()=>[s(d(o.value.requestUrl),1)]),_:1}),e(i,{label:"操作IP"},{default:t(()=>[s(d(o.value.ip),1)]),_:1}),e(i,{label:"操作状态"},{default:t(()=>[e(C,{type:o.value.status===1?"success":"danger"},{default:t(()=>[s(d(o.value.status===1?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),e(i,{label:"浏览器"},{default:t(()=>[s(d(o.value.browser),1)]),_:1}),e(i,{label:"操作系统"},{default:t(()=>[s(d(o.value.os),1)]),_:1}),e(i,{label:"执行耗时"},{default:t(()=>[s(d(o.value.duration)+" ms",1)]),_:1}),e(i,{label:"操作时间"},{default:t(()=>[s(d(o.value.createTime),1)]),_:1})]),_:1}),o.value.requestParams?(c(),b(R,{key:0,"content-position":"left"},{default:t(()=>[...l[19]||(l[19]=[s("请求参数",-1)])]),_:1})):T("",!0),o.value.requestParams?(c(),b(U,{key:1,modelValue:o.value.requestParams,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.requestParams=a),type:"textarea",rows:4,readonly:""},null,8,["modelValue"])):T("",!0),o.value.responseResult?(c(),b(R,{key:2,"content-position":"left"},{default:t(()=>[...l[20]||(l[20]=[s("响应结果",-1)])]),_:1})):T("",!0),o.value.responseResult?(c(),b(U,{key:3,modelValue:o.value.responseResult,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.responseResult=a),type:"textarea",rows:4,readonly:""},null,8,["modelValue"])):T("",!0),o.value.errorMsg?(c(),b(R,{key:4,"content-position":"left"},{default:t(()=>[...l[21]||(l[21]=[s("错误信息",-1)])]),_:1})):T("",!0),o.value.errorMsg?(c(),b(le,{key:5,title:o.value.errorMsg,type:"error",closable:!1},null,8,["title"])):T("",!0)]),_:1},8,["modelValue"]),e($,{modelValue:x.value,"onUpdate:modelValue":l[13]||(l[13]=a=>x.value=a),title:"清理操作日志",width:"400px"},{footer:t(()=>[e(f,{onClick:l[12]||(l[12]=a=>x.value=!1)},{default:t(()=>[...l[24]||(l[24]=[s("取消",-1)])]),_:1}),e(f,{type:"danger",onClick:X},{default:t(()=>[...l[25]||(l[25]=[s("确认清理",-1)])]),_:1})]),default:t(()=>[e(N,{model:E,"label-width":"100px"},{default:t(()=>[e(v,{label:"保留天数"},{default:t(()=>[e(te,{modelValue:E.days,"onUpdate:modelValue":l[11]||(l[11]=a=>E.days=a),min:1,max:365},null,8,["modelValue"]),l[23]||(l[23]=A("span",{style:{"margin-left":"10px",color:"#909399"}},"天前的日志将被删除",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},xe=oe(we,[["__scopeId","data-v-a1beebf5"]]);export{xe as default};
