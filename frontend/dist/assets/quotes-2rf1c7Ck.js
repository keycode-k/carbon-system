import{g as Z,a as h,p as ee,m as le}from"./trade-DCpYU1nh.js";import{_ as te,r as i,i as ae,c as z,d as l,w as a,f as n,E as y,m as oe,o as p,e as o,l as ue,g as b,t as U,q as L,b as ne,p as re}from"./index-CAroDxw1.js";import"./request-xGXa7hEd.js";const se={class:"app-container"},de={key:0},ie={key:1,style:{color:"#909399"}},pe={__name:"quotes",setup(me){const P=i(1),s=i({type:"",assetType:"",status:"",page:1,size:10}),I=i([]),N=i(0),T=i(!1),k=i(!1),C=i(!1),r=i({userId:1,type:"BUY",assetType:"QUOTA",quantity:100,expectPrice:50,validUntil:null,remark:""}),x=i(!1),D=i(!1),_=i({}),w=i({finalPrice:0}),v=async()=>{T.value=!0;try{const u=await Z(s.value);I.value=u.records,N.value=u.total}catch(u){console.error("加载询报价列表失败:",u),y.error("加载列表失败")}finally{T.value=!1}},M=()=>{s.value={type:"",assetType:"",status:"",page:1,size:10},v()},S=()=>{r.value={userId:P.value,type:"BUY",assetType:"QUOTA",quantity:100,expectPrice:50,validUntil:null,remark:""},k.value=!0},$=async()=>{C.value=!0;try{await ee(r.value),y.success("发布成功"),k.value=!1,v()}catch(u){console.error("发布失败:",u),y.error("发布失败")}finally{C.value=!1}},F=u=>{_.value=u,w.value.finalPrice=u.expectPrice,x.value=!0},G=async()=>{if(!w.value.finalPrice||w.value.finalPrice<=0){y.warning("请输入有效的报价");return}D.value=!0;try{await le(_.value.id,w.value.finalPrice),y.success("报价成功"),x.value=!1,v()}catch(u){console.error("报价失败:",u),y.error("报价失败")}finally{D.value=!1}},R=async u=>{try{await re.confirm("确认接受此报价吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await h(u,P.value),y.success("接受成功"),v()}catch(e){e!=="cancel"&&(console.error("接受失败:",e),y.error("接受失败"))}},j=u=>u?u.replace("T"," ").substring(0,16):"-";return ae(()=>{v()}),(u,e)=>{const g=n("el-option"),E=n("el-select"),d=n("el-form-item"),f=n("el-button"),Q=n("el-form"),Y=n("el-card"),m=n("el-table-column"),V=n("el-tag"),H=n("el-table"),J=n("el-pagination"),c=n("el-radio"),O=n("el-radio-group"),B=n("el-input-number"),K=n("el-date-picker"),q=n("el-input"),A=n("el-dialog"),W=oe("loading");return p(),z("div",se,[l(Y,{style:{"margin-bottom":"20px"}},{default:a(()=>[l(Q,{inline:!0,model:s.value},{default:a(()=>[l(d,{label:"订单类型"},{default:a(()=>[l(E,{modelValue:s.value.type,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.type=t),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:a(()=>[l(g,{label:"买入",value:"BUY"}),l(g,{label:"卖出",value:"SELL"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"资产类型"},{default:a(()=>[l(E,{modelValue:s.value.assetType,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.assetType=t),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:a(()=>[l(g,{label:"配额",value:"QUOTA"}),l(g,{label:"信用",value:"CREDIT"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"状态"},{default:a(()=>[l(E,{modelValue:s.value.status,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.status=t),placeholder:"全部",clearable:"",style:{width:"140px"}},{default:a(()=>[l(g,{label:"待报价",value:"PENDING"}),l(g,{label:"已报价",value:"QUOTED"})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(f,{type:"primary",onClick:v},{default:a(()=>[...e[18]||(e[18]=[o("查询",-1)])]),_:1}),l(f,{onClick:M},{default:a(()=>[...e[19]||(e[19]=[o("重置",-1)])]),_:1}),l(f,{type:"success",onClick:S},{default:a(()=>[...e[20]||(e[20]=[o("发布询价",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(Y,null,{header:a(()=>[...e[21]||(e[21]=[ne("span",null,"市场询报价单",-1)])]),default:a(()=>[ue((p(),b(H,{data:I.value,border:"",stripe:""},{default:a(()=>[l(m,{prop:"id",label:"询价单号",width:"100"}),l(m,{prop:"type",label:"类型",width:"80"},{default:a(t=>[l(V,{type:t.row.type==="BUY"?"danger":"success"},{default:a(()=>[o(U(t.row.type==="BUY"?"买入":"卖出"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"assetType",label:"资产类型",width:"100"},{default:a(t=>[o(U(t.row.assetType==="QUOTA"?"配额":"信用"),1)]),_:1}),l(m,{prop:"quantity",label:"数量（吨）",width:"120"}),l(m,{prop:"expectPrice",label:"期望价格",width:"120"},{default:a(t=>[o("¥"+U(t.row.expectPrice),1)]),_:1}),l(m,{prop:"finalPrice",label:"报价",width:"120"},{default:a(t=>[t.row.finalPrice?(p(),z("span",de,"¥"+U(t.row.finalPrice),1)):(p(),z("span",ie,"-"))]),_:1}),l(m,{prop:"status",label:"状态",width:"100"},{default:a(t=>[t.row.status==="PENDING"?(p(),b(V,{key:0,type:"warning"},{default:a(()=>[...e[22]||(e[22]=[o("待报价",-1)])]),_:1})):t.row.status==="QUOTED"?(p(),b(V,{key:1,type:"primary"},{default:a(()=>[...e[23]||(e[23]=[o("已报价",-1)])]),_:1})):t.row.status==="ACCEPTED"?(p(),b(V,{key:2,type:"success"},{default:a(()=>[...e[24]||(e[24]=[o("已接受",-1)])]),_:1})):t.row.status==="REJECTED"?(p(),b(V,{key:3,type:"danger"},{default:a(()=>[...e[25]||(e[25]=[o("已拒绝",-1)])]),_:1})):(p(),b(V,{key:4,type:"info"},{default:a(()=>[o(U(t.row.status),1)]),_:2},1024))]),_:1}),l(m,{prop:"validUntil",label:"有效期至",width:"160"},{default:a(t=>[o(U(t.row.validUntil?j(t.row.validUntil):"-"),1)]),_:1}),l(m,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),l(m,{label:"操作",width:"150",fixed:"right"},{default:a(t=>[t.row.status==="PENDING"?(p(),b(f,{key:0,type:"primary",size:"small",onClick:X=>F(t.row)},{default:a(()=>[...e[26]||(e[26]=[o(" 报价 ",-1)])]),_:1},8,["onClick"])):L("",!0),t.row.status==="QUOTED"&&t.row.userId===P.value?(p(),b(f,{key:1,type:"success",size:"small",onClick:X=>R(t.row.id)},{default:a(()=>[...e[27]||(e[27]=[o(" 接受 ",-1)])]),_:1},8,["onClick"])):L("",!0)]),_:1})]),_:1},8,["data"])),[[W,T.value]]),l(J,{"current-page":s.value.page,"onUpdate:currentPage":e[3]||(e[3]=t=>s.value.page=t),"page-size":s.value.size,"onUpdate:pageSize":e[4]||(e[4]=t=>s.value.size=t),total:N.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px","justify-content":"center"},onCurrentChange:v,onSizeChange:v},null,8,["current-page","page-size","total"])]),_:1}),l(A,{modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=t=>k.value=t),title:"发布询价单",width:"500px"},{footer:a(()=>[l(f,{onClick:e[11]||(e[11]=t=>k.value=!1)},{default:a(()=>[...e[32]||(e[32]=[o("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:$,loading:C.value},{default:a(()=>[...e[33]||(e[33]=[o("发布",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(Q,{model:r.value,"label-width":"100px"},{default:a(()=>[l(d,{label:"订单类型"},{default:a(()=>[l(O,{modelValue:r.value.type,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.type=t)},{default:a(()=>[l(c,{value:"BUY"},{default:a(()=>[...e[28]||(e[28]=[o("买入",-1)])]),_:1}),l(c,{value:"SELL"},{default:a(()=>[...e[29]||(e[29]=[o("卖出",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"资产类型"},{default:a(()=>[l(O,{modelValue:r.value.assetType,"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.assetType=t)},{default:a(()=>[l(c,{value:"QUOTA"},{default:a(()=>[...e[30]||(e[30]=[o("配额",-1)])]),_:1}),l(c,{value:"CREDIT"},{default:a(()=>[...e[31]||(e[31]=[o("信用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"数量（吨）"},{default:a(()=>[l(B,{modelValue:r.value.quantity,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value.quantity=t),min:1,max:1e5},null,8,["modelValue"])]),_:1}),l(d,{label:"期望价格"},{default:a(()=>[l(B,{modelValue:r.value.expectPrice,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value.expectPrice=t),min:.01,precision:2},null,8,["modelValue"])]),_:1}),l(d,{label:"有效期"},{default:a(()=>[l(K,{modelValue:r.value.validUntil,"onUpdate:modelValue":e[9]||(e[9]=t=>r.value.validUntil=t),type:"datetime",placeholder:"选择有效期","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(d,{label:"备注"},{default:a(()=>[l(q,{modelValue:r.value.remark,"onUpdate:modelValue":e[10]||(e[10]=t=>r.value.remark=t),type:"textarea",rows:3,maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(A,{modelValue:x.value,"onUpdate:modelValue":e[17]||(e[17]=t=>x.value=t),title:"报价",width:"400px"},{footer:a(()=>[l(f,{onClick:e[16]||(e[16]=t=>x.value=!1)},{default:a(()=>[...e[35]||(e[35]=[o("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:G,loading:D.value},{default:a(()=>[...e[36]||(e[36]=[o("确认报价",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(Q,{model:w.value,"label-width":"100px"},{default:a(()=>[l(d,{label:"询价单号"},{default:a(()=>[l(q,{modelValue:_.value.id,"onUpdate:modelValue":e[13]||(e[13]=t=>_.value.id=t),disabled:""},null,8,["modelValue"])]),_:1}),l(d,{label:"期望价格"},{default:a(()=>[l(q,{modelValue:_.value.expectPrice,"onUpdate:modelValue":e[14]||(e[14]=t=>_.value.expectPrice=t),disabled:""},{prepend:a(()=>[...e[34]||(e[34]=[o("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"报价"},{default:a(()=>[l(B,{modelValue:w.value.finalPrice,"onUpdate:modelValue":e[15]||(e[15]=t=>w.value.finalPrice=t),min:.01,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},be=te(pe,[["__scopeId","data-v-d7a528ee"]]);export{be as default};
