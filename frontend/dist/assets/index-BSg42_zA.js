import{_ as D,u as F,r as g,a as P,c as M,b as t,d as s,e as i,w as o,f as a,g as j,o as V,h as L,i as h,n as q,l as E,E as w,j as A}from"./index-Dl24hcOp.js";const G={class:"login-container"},H={class:"login-content"},J={class:"login-title"},O={class:"feature-list"},Q={class:"feature-item"},W={class:"feature-item"},X={class:"feature-item"},Y={class:"card-header-tabs"},Z={class:"login-options"},ee={class:"register-footer"},se={__name:"index",setup(oe){const b=j(),x=F(),p=g(!1),u=g(!0),U=g(!1),v=g(null),_=g(null),d=P({username:"",password:""}),I={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},l=P({username:"",password:"",confirmPassword:""}),T={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:16,message:"长度在 4 到 16 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,validator:(f,e,r)=>{e===""?r(new Error("请再次输入密码")):e!==l.password?r(new Error("两次输入密码不一致!")):r()},trigger:"blur"}]},C=async()=>{v.value&&await v.value.validate(async f=>{if(f){p.value=!0;try{const e=await E(d);e&&e.token?(w.success("登录成功"),x.setUserInfo({id:e.userId||e.id||1,username:e.username||d.username,nickname:e.nickname||"",token:e.token,refreshToken:e.refreshToken||"",roles:e.roles||[],permissions:e.permissions||[]}),b.push("/")):w.error("登录失败，请检查用户名或密码")}catch(e){console.error(e)}finally{p.value=!1}}})},B=async()=>{_.value&&await _.value.validate(async f=>{if(f){p.value=!0;try{const e=await A({username:l.username,password:l.password});if(e&&(e.success||e.code===200||e===null)){w.success("注册成功，正在为您自动登录...");try{const r=await E({username:l.username,password:l.password});r&&r.token?(x.setUserInfo({id:r.userId||r.id||1,username:r.username||l.username,token:r.token,roles:r.roles||[]}),b.push("/")):(w.warning("自动登录失败，请手动登录"),u.value=!0,d.username=l.username)}catch(r){console.error(r),u.value=!0}}else w.error(e.message||"注册失败")}catch(e){console.error(e)}finally{p.value=!1}}})};return(f,e)=>{const r=a("DataLine"),y=a("el-icon"),S=a("TrendCharts"),z=a("SetUp"),c=a("el-input"),m=a("el-form-item"),K=a("el-checkbox"),k=a("el-button"),R=a("el-form"),N=a("el-link"),$=a("el-card");return V(),M("div",G,[t("div",H,[t("div",J,[e[12]||(e[12]=t("h1",{class:"system-name"},"碳中和",-1)),e[13]||(e[13]=t("h2",{class:"sub-title"},"数字碳资产管理系统",-1)),t("div",O,[t("div",Q,[s(y,null,{default:o(()=>[s(r)]),_:1}),e[9]||(e[9]=i(" 全流程碳资产开发管理",-1))]),t("div",W,[s(y,null,{default:o(()=>[s(S)]),_:1}),e[10]||(e[10]=i(" 实时碳交易行情监控",-1))]),t("div",X,[s(y,null,{default:o(()=>[s(z)]),_:1}),e[11]||(e[11]=i(" 智能配额履约分析",-1))])])]),s($,{class:"login-card",shadow:"always"},{header:o(()=>[t("div",Y,[t("span",{class:q({active:u.value}),onClick:e[0]||(e[0]=n=>u.value=!0)},"用户登录",2),e[14]||(e[14]=t("span",{class:"divider"},"|",-1)),t("span",{class:q({active:!u.value}),onClick:e[1]||(e[1]=n=>u.value=!1)},"注册账号",2)])]),default:o(()=>[u.value?(V(),L(R,{key:0,ref_key:"loginRef",ref:v,model:d,rules:I,"label-width":"0",size:"large"},{default:o(()=>[s(m,{prop:"username"},{default:o(()=>[s(c,{modelValue:d.username,"onUpdate:modelValue":e[2]||(e[2]=n=>d.username=n),"prefix-icon":"User",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),s(m,{prop:"password"},{default:o(()=>[s(c,{modelValue:d.password,"onUpdate:modelValue":e[3]||(e[3]=n=>d.password=n),"prefix-icon":"Lock",type:"password",placeholder:"请输入密码","show-password":"",onKeyup:h(C,["enter"])},null,8,["modelValue"])]),_:1}),s(m,null,{default:o(()=>[t("div",Z,[s(K,{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=n=>U.value=n)},{default:o(()=>[...e[15]||(e[15]=[i("记住密码",-1)])]),_:1},8,["modelValue"]),s(k,{link:"",type:"primary"},{default:o(()=>[...e[16]||(e[16]=[i("忘记密码？",-1)])]),_:1})])]),_:1}),s(m,null,{default:o(()=>[s(k,{type:"primary",class:"action-btn",onClick:C,loading:p.value},{default:o(()=>[...e[17]||(e[17]=[i("立即登录",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):(V(),L(R,{key:1,ref_key:"registerRef",ref:_,model:l,rules:T,"label-width":"0",size:"large"},{default:o(()=>[s(m,{prop:"username"},{default:o(()=>[s(c,{modelValue:l.username,"onUpdate:modelValue":e[5]||(e[5]=n=>l.username=n),"prefix-icon":"User",placeholder:"设置用户名 (4-16位)"},null,8,["modelValue"])]),_:1}),s(m,{prop:"password"},{default:o(()=>[s(c,{modelValue:l.password,"onUpdate:modelValue":e[6]||(e[6]=n=>l.password=n),"prefix-icon":"Lock",type:"password",placeholder:"设置密码 (6位以上)","show-password":""},null,8,["modelValue"])]),_:1}),s(m,{prop:"confirmPassword"},{default:o(()=>[s(c,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=n=>l.confirmPassword=n),"prefix-icon":"Key",type:"password",placeholder:"确认密码","show-password":""},null,8,["modelValue"])]),_:1}),s(m,null,{default:o(()=>[s(k,{type:"success",class:"action-btn",onClick:B,loading:p.value},{default:o(()=>[...e[18]||(e[18]=[i("注册并登录",-1)])]),_:1},8,["loading"])]),_:1}),t("div",ee,[e[20]||(e[20]=i(" 已有账号？",-1)),s(N,{type:"primary",onClick:e[8]||(e[8]=n=>u.value=!0)},{default:o(()=>[...e[19]||(e[19]=[i("直接登录",-1)])]),_:1})])]),_:1},8,["model"]))]),_:1})])])}}},ne=D(se,[["__scopeId","data-v-db08c1cf"]]);export{ne as default};
