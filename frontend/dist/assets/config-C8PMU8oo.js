import{_ as se,a as F,r as c,m as de,c as U,d as l,w as a,f as r,t as ue,o as _,q as pe,b as fe,W as L,X as S,h as K,x as g,U as ce,e as s,$ as ge,B as me,a7 as A,ab as ye,v as B,a5 as _e,L as I,E as w}from"./index-Dl24hcOp.js";import{z as be,A as ve,B as Ve,C as we,D as Ce,E as ke,F as Te,G as xe}from"./system-DaJnZECp.js";const Ge={class:"app-container"},he={class:"pagination-container"},ze={__name:"config",setup(Ne){const i=F({configName:"",configKey:"",configGroup:"",configType:null,page:1,size:10}),D=c([]),E=c(0),C=c(!1),b=c([]),k=c(["system","account","trade","upload","notification","log"]),m=c(!1),T=c(""),x=c(null),n=F({id:null,configName:"",configKey:"",configValue:"",configGroup:"default",configType:2,status:1,remark:""}),M={configName:[{required:!0,message:"请输入配置名称",trigger:"blur"}],configKey:[{required:!0,message:"请输入配置键名",trigger:"blur"},{pattern:/^[a-zA-Z][a-zA-Z0-9._-]*$/,message:"键名以字母开头，只能包含字母、数字、点、下划线和横线",trigger:"blur"}],configValue:[{required:!0,message:"请输入配置值",trigger:"blur"}],configGroup:[{required:!0,message:"请选择配置分组",trigger:"change"}]},j={system:"primary",account:"success",trade:"warning",upload:"info",notification:"danger",log:""},O=t=>j[t]||"info",f=async()=>{C.value=!0;try{const t=await be(i);t.code===200&&(D.value=t.data.records||[],E.value=t.data.total||0)}catch(t){console.error("获取配置列表失败:",t)}finally{C.value=!1}},R=async()=>{try{const t=await ve();t.code===200&&t.data?.length&&(k.value=t.data)}catch(t){console.error("获取分组失败:",t)}},P=()=>{i.page=1,f()},Q=()=>{i.configName="",i.configKey="",i.configGroup="",i.configType=null,i.page=1,f()},Z=t=>{b.value=t.map(e=>e.id)},W=()=>{G(),T.value="新增配置",m.value=!0},X=async t=>{G(),T.value="编辑配置";try{const e=await Ce(t.id);e.code===200&&Object.assign(n,e.data)}catch{Object.assign(n,t)}m.value=!0},H=async t=>{try{await I.confirm(`确定要删除配置"${t.configName}"吗？`,"提示",{type:"warning"}),(await ke(t.id)).code===200&&(w.success("删除成功"),f())}catch(e){e!=="cancel"&&console.error("删除失败:",e)}},J=async()=>{try{await I.confirm(`确定要删除选中的${b.value.length}条配置吗？`,"提示",{type:"warning"});const t=await Ve(b.value);t.code===200&&(w.success(t.data||"删除成功"),f())}catch(t){t!=="cancel"&&console.error("批量删除失败:",t)}},Y=async()=>{try{(await we()).code===200&&w.success("缓存刷新成功")}catch(t){console.error("刷新缓存失败:",t)}},ee=async()=>{try{await x.value?.validate();const t=!!n.id;(t?await Te(n):await xe(n)).code===200&&(w.success(t?"更新成功":"创建成功"),m.value=!1,f())}catch(t){console.error("提交失败:",t)}},G=()=>{n.id=null,n.configName="",n.configKey="",n.configValue="",n.configGroup="default",n.configType=2,n.status=1,n.remark="",x.value?.resetFields()};return de(()=>{f(),R()}),(t,e)=>{const y=r("el-input"),d=r("el-form-item"),v=r("el-option"),h=r("el-select"),u=r("el-button"),$=r("el-form"),z=r("el-col"),le=r("el-row"),p=r("el-table-column"),N=r("el-tag"),oe=r("el-table"),ae=r("el-pagination"),te=r("el-card"),V=r("el-radio"),q=r("el-radio-group"),ne=r("el-dialog"),ie=ue("loading");return _(),U("div",Ge,[l(te,{shadow:"never"},{default:a(()=>[l($,{inline:!0,model:i,class:"search-form"},{default:a(()=>[l(d,{label:"配置名称"},{default:a(()=>[l(y,{modelValue:i.configName,"onUpdate:modelValue":e[0]||(e[0]=o=>i.configName=o),placeholder:"请输入配置名称",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(d,{label:"配置键名"},{default:a(()=>[l(y,{modelValue:i.configKey,"onUpdate:modelValue":e[1]||(e[1]=o=>i.configKey=o),placeholder:"请输入配置键名",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(d,{label:"配置分组"},{default:a(()=>[l(h,{modelValue:i.configGroup,"onUpdate:modelValue":e[2]||(e[2]=o=>i.configGroup=o),placeholder:"请选择",clearable:"",style:{width:"130px"}},{default:a(()=>[(_(!0),U(L,null,S(k.value,o=>(_(),K(v,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"配置类型"},{default:a(()=>[l(h,{modelValue:i.configType,"onUpdate:modelValue":e[3]||(e[3]=o=>i.configType=o),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:a(()=>[l(v,{label:"系统内置",value:1}),l(v,{label:"自定义",value:2})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(u,{type:"primary",icon:g(ce),onClick:P},{default:a(()=>[...e[15]||(e[15]=[s("搜索",-1)])]),_:1},8,["icon"]),l(u,{icon:g(ge),onClick:Q},{default:a(()=>[...e[16]||(e[16]=[s("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),l(le,{gutter:10,class:"mb10"},{default:a(()=>[l(z,{span:1.5},{default:a(()=>[l(u,{type:"primary",plain:"",icon:g(me),onClick:W},{default:a(()=>[...e[17]||(e[17]=[s("新增",-1)])]),_:1},8,["icon"])]),_:1}),l(z,{span:1.5},{default:a(()=>[l(u,{type:"danger",plain:"",icon:g(A),disabled:!b.value.length,onClick:J},{default:a(()=>[...e[18]||(e[18]=[s("批量删除",-1)])]),_:1},8,["icon","disabled"])]),_:1}),l(z,{span:1.5},{default:a(()=>[l(u,{type:"success",plain:"",icon:g(ye),onClick:Y},{default:a(()=>[...e[19]||(e[19]=[s("刷新缓存",-1)])]),_:1},8,["icon"])]),_:1})]),_:1}),pe((_(),K(oe,{data:D.value,onSelectionChange:Z,style:{width:"100%"}},{default:a(()=>[l(p,{type:"selection",width:"55",selectable:o=>o.configType!==1},null,8,["selectable"]),l(p,{prop:"id",label:"ID",width:"60"}),l(p,{prop:"configName",label:"配置名称",width:"180","show-overflow-tooltip":""}),l(p,{prop:"configKey",label:"配置键名",width:"200","show-overflow-tooltip":""},{default:a(({row:o})=>[l(N,{type:"info",size:"small"},{default:a(()=>[s(B(o.configKey),1)]),_:2},1024)]),_:1}),l(p,{prop:"configValue",label:"配置值","min-width":"200","show-overflow-tooltip":""}),l(p,{prop:"configGroup",label:"分组",width:"100"},{default:a(({row:o})=>[l(N,{type:O(o.configGroup),size:"small"},{default:a(()=>[s(B(o.configGroup),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"configType",label:"类型",width:"90"},{default:a(({row:o})=>[l(N,{type:o.configType===1?"warning":"success",size:"small"},{default:a(()=>[s(B(o.configType===1?"内置":"自定义"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"remark",label:"备注",width:"150","show-overflow-tooltip":""}),l(p,{label:"操作",width:"150",fixed:"right"},{default:a(({row:o})=>[l(u,{type:"primary",link:"",icon:g(_e),onClick:re=>X(o)},{default:a(()=>[...e[20]||(e[20]=[s("编辑",-1)])]),_:1},8,["icon","onClick"]),l(u,{type:"danger",link:"",icon:g(A),disabled:o.configType===1,onClick:re=>H(o)},{default:a(()=>[...e[21]||(e[21]=[s("删除",-1)])]),_:1},8,["icon","disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[ie,C.value]]),fe("div",he,[l(ae,{"current-page":i.page,"onUpdate:currentPage":e[4]||(e[4]=o=>i.page=o),"page-size":i.size,"onUpdate:pageSize":e[5]||(e[5]=o=>i.size=o),"page-sizes":[10,20,50,100],total:E.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","total"])])]),_:1}),l(ne,{modelValue:m.value,"onUpdate:modelValue":e[14]||(e[14]=o=>m.value=o),title:T.value,width:"550px",onClose:G},{footer:a(()=>[l(u,{onClick:e[13]||(e[13]=o=>m.value=!1)},{default:a(()=>[...e[26]||(e[26]=[s("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:ee},{default:a(()=>[...e[27]||(e[27]=[s("确定",-1)])]),_:1})]),default:a(()=>[l($,{ref_key:"formRef",ref:x,model:n,rules:M,"label-width":"100px"},{default:a(()=>[l(d,{label:"配置名称",prop:"configName"},{default:a(()=>[l(y,{modelValue:n.configName,"onUpdate:modelValue":e[6]||(e[6]=o=>n.configName=o),placeholder:"请输入配置名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"配置键名",prop:"configKey"},{default:a(()=>[l(y,{modelValue:n.configKey,"onUpdate:modelValue":e[7]||(e[7]=o=>n.configKey=o),placeholder:"请输入配置键名",disabled:n.id&&n.configType===1},null,8,["modelValue","disabled"])]),_:1}),l(d,{label:"配置值",prop:"configValue"},{default:a(()=>[l(y,{modelValue:n.configValue,"onUpdate:modelValue":e[8]||(e[8]=o=>n.configValue=o),type:"textarea",rows:3,placeholder:"请输入配置值"},null,8,["modelValue"])]),_:1}),l(d,{label:"配置分组",prop:"configGroup"},{default:a(()=>[l(h,{modelValue:n.configGroup,"onUpdate:modelValue":e[9]||(e[9]=o=>n.configGroup=o),placeholder:"请选择或输入分组",filterable:"","allow-create":"",style:{width:"100%"}},{default:a(()=>[(_(!0),U(L,null,S(k.value,o=>(_(),K(v,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"配置类型",prop:"configType"},{default:a(()=>[l(q,{modelValue:n.configType,"onUpdate:modelValue":e[10]||(e[10]=o=>n.configType=o),disabled:!!n.id},{default:a(()=>[l(V,{value:1},{default:a(()=>[...e[22]||(e[22]=[s("系统内置",-1)])]),_:1}),l(V,{value:2},{default:a(()=>[...e[23]||(e[23]=[s("自定义",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(d,{label:"状态",prop:"status"},{default:a(()=>[l(q,{modelValue:n.status,"onUpdate:modelValue":e[11]||(e[11]=o=>n.status=o)},{default:a(()=>[l(V,{value:1},{default:a(()=>[...e[24]||(e[24]=[s("正常",-1)])]),_:1}),l(V,{value:0},{default:a(()=>[...e[25]||(e[25]=[s("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"备注",prop:"remark"},{default:a(()=>[l(y,{modelValue:n.remark,"onUpdate:modelValue":e[12]||(e[12]=o=>n.remark=o),type:"textarea",rows:2,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Be=se(ze,[["__scopeId","data-v-e4d73212"]]);export{Be as default};
