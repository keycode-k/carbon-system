import{_ as O,u as J,r as w,a as E,m as K,c as R,d as l,w as t,f as n,I as h,o as j,b as a,v as k,e as m,J as G,E as b,K as H,L as W,M as X}from"./index-Dl24hcOp.js";import{l as Y,g as Z}from"./assets-C4YOj4Dt.js";const $={class:"app-container"},ee={class:"user-header"},le={class:"user-name"},te={class:"user-tags"},ae={class:"user-progress"},oe={class:"progress-item"},se={class:"progress-item"},ne={class:"asset-summary-box"},de={class:"num"},re={class:"asset-summary-box"},ue={class:"num"},ie={class:"danger-zone"},me={__name:"info",setup(pe){const z=J(),v=w(""),o=E({nickname:"",phone:"",email:"",bio:""}),U=w(0),C=w(0),A=w("basic"),L=w(65),I=w(30),r=E({oldPassword:"",newPassword:"",confirmPassword:""}),M=async()=>{try{await G(o),b.success("更新成功"),S()}catch{}},Q=async()=>{if(r.newPassword!==r.confirmPassword){b.error("两次密码不一致");return}try{await H({username:v.value,oldPassword:r.oldPassword,newPassword:r.newPassword}),b.success("密码修改成功")}catch{}},D=async()=>{try{if(await W.confirm("确定要注销账号吗？此操作不可逆！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),!o.id){b.error("无法获取用户ID");return}await X(o.id),b.success("账户已注销"),localStorage.clear(),window.location.reload()}catch{}},S=async()=>{const d=localStorage.getItem("token");if(d)try{const e=await h(d);if(e){v.value=e.username,o.id=e.id,o.nickname=e.nickname,o.phone=e.phone,o.email=e.email,o.bio=e.bio||"这家伙很懒，什么都没留下";let u=20;e.nickname&&(u+=20),e.phone&&(u+=20),e.email&&(u+=20),e.bio&&(u+=20),I.value=u}}catch(e){console.error(e)}},N=async()=>{try{const d=z.userId||o.id||1,e=await Y(d);let u=0;e&&Array.isArray(e)&&(u=e.reduce((_,p)=>_+(p.totalQuota||0),0)),U.value=u;const f=await Z(d);let g=0;const y=f&&Array.isArray(f)?f:f?.data||[];Array.isArray(y)&&(g=y.reduce((_,p)=>_+(p.amount||0),0)),C.value=g}catch(d){console.error("Failed to fetch assets",d)}};return K(async()=>{await S(),await N()}),(d,e)=>{const u=n("el-avatar"),f=n("el-tag"),g=n("el-divider"),y=n("el-progress"),_=n("el-card"),p=n("el-col"),c=n("el-input"),i=n("el-form-item"),V=n("el-button"),B=n("el-form"),x=n("el-tab-pane"),T=n("el-row"),P=n("el-collapse-item"),q=n("el-collapse"),F=n("el-tabs");return j(),R("div",$,[l(T,{gutter:20},{default:t(()=>[l(p,{span:8},{default:t(()=>[l(_,{class:"box-card",shadow:"hover"},{default:t(()=>[a("div",ee,[l(u,{size:100,src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}),a("h2",le,k(v.value),1),e[11]||(e[11]=a("p",{class:"user-role"},"注册用户",-1)),a("div",te,[l(f,{size:"small"},{default:t(()=>[...e[9]||(e[9]=[m("普通权限",-1)])]),_:1}),l(f,{size:"small",type:"success",style:{"margin-left":"5px"}},{default:t(()=>[...e[10]||(e[10]=[m("状态正常",-1)])]),_:1})])]),l(g),a("div",ae,[a("div",oe,[e[12]||(e[12]=a("span",null,"账户安全评分",-1)),l(y,{percentage:L.value,status:"warning"},null,8,["percentage"])]),a("div",se,[e[13]||(e[13]=a("span",null,"资料完善度",-1)),l(y,{percentage:I.value},null,8,["percentage"])])])]),_:1})]),_:1}),l(p,{span:16},{default:t(()=>[l(_,{shadow:"hover"},{header:t(()=>[...e[14]||(e[14]=[a("div",{class:"card-header"},[a("span",null,"个人资料编辑")],-1)])]),default:t(()=>[l(F,{modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=s=>A.value=s)},{default:t(()=>[l(x,{label:"基本信息",name:"basic"},{default:t(()=>[l(B,{"label-width":"100px",style:{"max-width":"500px","margin-top":"20px"}},{default:t(()=>[l(i,{label:"用户名"},{default:t(()=>[l(c,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),disabled:""},null,8,["modelValue"])]),_:1}),l(i,{label:"昵称"},{default:t(()=>[l(c,{modelValue:o.nickname,"onUpdate:modelValue":e[1]||(e[1]=s=>o.nickname=s),placeholder:"暂无信息"},null,8,["modelValue"])]),_:1}),l(i,{label:"手机号"},{default:t(()=>[l(c,{modelValue:o.phone,"onUpdate:modelValue":e[2]||(e[2]=s=>o.phone=s),placeholder:"暂无信息"},null,8,["modelValue"])]),_:1}),l(i,{label:"邮箱"},{default:t(()=>[l(c,{modelValue:o.email,"onUpdate:modelValue":e[3]||(e[3]=s=>o.email=s),placeholder:"暂无信息"},null,8,["modelValue"])]),_:1}),l(i,{label:"个人简介"},{default:t(()=>[l(c,{modelValue:o.bio,"onUpdate:modelValue":e[4]||(e[4]=s=>o.bio=s),type:"textarea",rows:3,placeholder:"暂无信息"},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(V,{type:"primary",onClick:M},{default:t(()=>[...e[15]||(e[15]=[m("保存修改",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{label:"资产概览",name:"assets"},{default:t(()=>[l(_,{shadow:"never"},{default:t(()=>[l(T,{gutter:40},{default:t(()=>[l(p,{span:12},{default:t(()=>[a("div",ne,[e[17]||(e[17]=a("h3",null,"持有配额 (Quota)",-1)),a("div",de,[m(k(U.value.toLocaleString())+" ",1),e[16]||(e[16]=a("small",null,"tCO2e",-1))])])]),_:1}),l(p,{span:12},{default:t(()=>[a("div",re,[e[19]||(e[19]=a("h3",null,"持有信用 (CCER)",-1)),a("div",ue,[m(k(C.value.toLocaleString())+" ",1),e[18]||(e[18]=a("small",null,"tCO2e",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{label:"安全设置",name:"security"},{default:t(()=>[l(q,{accordion:""},{default:t(()=>[l(P,{title:"修改密码",name:"1"},{default:t(()=>[l(B,{"label-width":"100px",style:{"max-width":"500px"}},{default:t(()=>[l(i,{label:"旧密码"},{default:t(()=>[l(c,{type:"password",modelValue:r.oldPassword,"onUpdate:modelValue":e[5]||(e[5]=s=>r.oldPassword=s)},null,8,["modelValue"])]),_:1}),l(i,{label:"新密码"},{default:t(()=>[l(c,{type:"password",modelValue:r.newPassword,"onUpdate:modelValue":e[6]||(e[6]=s=>r.newPassword=s)},null,8,["modelValue"])]),_:1}),l(i,{label:"确认密码"},{default:t(()=>[l(c,{type:"password",modelValue:r.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=s=>r.confirmPassword=s)},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(V,{type:"warning",onClick:Q},{default:t(()=>[...e[20]||(e[20]=[m("修改密码",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(P,{title:"绑定手机",name:"2"},{default:t(()=>[a("div",null,[e[22]||(e[22]=m("当前未绑定手机 ",-1)),l(V,{type:"primary",link:""},{default:t(()=>[...e[21]||(e[21]=[m("立即绑定",-1)])]),_:1})])]),_:1}),l(P,{title:"注销账户",name:"3"},{default:t(()=>[a("div",ie,[e[24]||(e[24]=a("p",null,"注销账户将永久删除您的所有个人信息，且无法恢复。",-1)),l(V,{type:"danger",onClick:D},{default:t(()=>[...e[23]||(e[23]=[m("确认注销账户",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])}}},_e=O(me,[["__scopeId","data-v-f6e97972"]]);export{_e as default};
