import{a as O,b as z}from"./assets-C4YOj4Dt.js";import{_ as I,r as k,u as M,k as C,O as U,m as P,q as R,t as T,c as h,b as t,d as a,w as s,f as r,n as _,h as E,v as n,e as b,P as $,N as A,E as Y,o as v,x as d,Q as j,R as F,S as G,T as H,A as J,D as K,U as W,V as X}from"./index-Dl24hcOp.js";const Z={class:"quota-container"},tt={class:"page-header"},et={class:"year-selector"},at={class:"overview-card"},st={class:"overview-header"},lt={class:"stats-row"},ot={class:"stat-item"},nt={class:"stat-icon green"},it={class:"stat-content"},ut={class:"stat-value"},rt={class:"stat-item"},dt={class:"stat-icon orange"},ct={class:"stat-content"},_t={class:"stat-value"},vt={class:"stat-item"},pt={class:"stat-content"},mt={class:"progress-section"},ft={class:"progress-header"},gt={class:"progress-bar-wrapper"},ht={class:"progress-tips"},bt={key:0},wt={key:1,class:"warning"},yt={key:2,class:"danger"},kt={class:"detail-card"},Qt={class:"card-header"},Dt={class:"header-title"},St={class:"date-cell"},Ct={class:"balance-value"},Et={key:0,class:"empty-state"},Vt={__name:"quota",setup(xt){const m=k("2025"),l=k({totalQuota:0,verifiedEmission:0,status:0}),Q=k(!1),w=k([]),V=M(),f=C(()=>l.value.totalQuota?l.value.totalQuota-l.value.verifiedEmission:0),i=C(()=>{if(!l.value.totalQuota||l.value.totalQuota===0)return 0;let c=Math.round(l.value.verifiedEmission/l.value.totalQuota*100);return c>100?100:c}),x=()=>i.value>95?"danger":i.value>80?"warning":"normal",D=async()=>{Q.value=!0;try{const c=V.userId||1,e=await O(c,m.value);if(e&&e.id){l.value=e;const p=await z(e.id);p&&(w.value=p.map(y=>({...y,date:y.changeDate})))}else l.value={totalQuota:0,verifiedEmission:0,status:0},w.value=[],Y.info(`${m.value}年暂无配额数据`)}catch(c){console.error(c)}finally{Q.value=!1}};return U(m,()=>{D()}),P(()=>{D()}),(c,e)=>{const p=r("el-option"),y=r("el-select"),u=r("el-icon"),S=r("el-button"),q=r("el-input"),g=r("el-table-column"),L=r("el-table"),N=r("el-empty"),B=T("loading");return R((v(),h("div",Z,[t("div",tt,[e[2]||(e[2]=t("div",{class:"header-info"},[t("h1",null,"碳配额管理"),t("p",null,"管理您的碳排放配额，追踪履约进度")],-1)),t("div",et,[e[1]||(e[1]=t("span",{class:"selector-label"},"履约年度",-1)),a(y,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),class:"year-select"},{default:s(()=>[a(p,{label:"2025年",value:"2025"}),a(p,{label:"2024年",value:"2024"}),a(p,{label:"2023年",value:"2023"})]),_:1},8,["modelValue"])])]),t("div",at,[t("div",st,[t("div",{class:_(["status-badge",l.value.status===1?"completed":"pending"])},[l.value.status===1?(v(),E(u,{key:0},{default:s(()=>[a(d(j))]),_:1})):(v(),E(u,{key:1},{default:s(()=>[a(d(F))]),_:1})),t("span",null,n(l.value.status===1?"履约完成":"待履约"),1)],2),a(S,{type:"primary",plain:"",size:"small",icon:"Download"},{default:s(()=>[...e[3]||(e[3]=[b("导出报表",-1)])]),_:1})]),t("div",lt,[t("div",ot,[t("div",nt,[a(u,null,{default:s(()=>[a(d(G))]),_:1})]),t("div",it,[t("span",ut,n(l.value.totalQuota?.toLocaleString()||0),1),e[4]||(e[4]=t("span",{class:"stat-label"},[b("发放总配额 "),t("small",null,"tCO2e")],-1))])]),e[7]||(e[7]=t("div",{class:"stat-divider"},null,-1)),t("div",rt,[t("div",dt,[a(u,null,{default:s(()=>[a(d(H))]),_:1})]),t("div",ct,[t("span",_t,n(l.value.verifiedEmission?.toLocaleString()||0),1),e[5]||(e[5]=t("span",{class:"stat-label"},[b("核查排放量 "),t("small",null,"tCO2e")],-1))])]),e[8]||(e[8]=t("div",{class:"stat-divider"},null,-1)),t("div",vt,[t("div",{class:_(["stat-icon",f.value>=0?"blue":"red"])},[a(u,null,{default:s(()=>[a(d(J))]),_:1})],2),t("div",pt,[t("span",{class:_(["stat-value",{positive:f.value>=0,negative:f.value<0}])},n(f.value>0?"+":"")+n(f.value.toLocaleString()),3),e[6]||(e[6]=t("span",{class:"stat-label"},[b("盈余配额 "),t("small",null,"tCO2e")],-1))])])]),t("div",mt,[t("div",ft,[e[9]||(e[9]=t("span",{class:"progress-title"},"配额使用率",-1)),t("span",{class:_(["progress-value",{warning:i.value>80,danger:i.value>95}])},n(i.value)+"% ",3)]),t("div",gt,[t("div",{class:_(["progress-bar",x()]),style:$({width:`${i.value}%`})},null,6)]),t("div",ht,[i.value<80?(v(),h("span",bt,"配额充足，可考虑出售多余配额")):i.value<95?(v(),h("span",wt,"配额使用率较高，请关注履约进度")):(v(),h("span",yt,"配额紧张，建议尽快购入配额"))])])]),t("div",kt,[t("div",Qt,[t("div",Dt,[a(u,null,{default:s(()=>[a(d(K))]),_:1}),e[10]||(e[10]=t("span",null,"配额明细记录",-1))]),a(q,{placeholder:"搜索记录...",class:"search-input",clearable:""},{prefix:s(()=>[a(u,null,{default:s(()=>[a(d(W))]),_:1})]),_:1})]),a(L,{data:w.value,class:"custom-table"},{default:s(()=>[a(g,{prop:"date",label:"变动日期",width:"160"},{default:s(o=>[t("div",St,[a(u,null,{default:s(()=>[a(d(X))]),_:1}),t("span",null,n(o.row.date),1)])]),_:1}),a(g,{prop:"type",label:"类型",width:"120"},{default:s(o=>[t("span",{class:_(["type-badge",o.row.type==="发放"?"issue":"change"])},n(o.row.type),3)]),_:1}),a(g,{prop:"amount",label:"变动数量",width:"150",align:"right"},{default:s(o=>[t("span",{class:_(["amount-value",o.row.amount>0?"plus":"minus"])},n(o.row.amount>0?"+":"")+n(o.row.amount?.toLocaleString()),3)]),_:1}),a(g,{prop:"balance",label:"结余",width:"150",align:"right"},{default:s(o=>[t("span",Ct,n(o.row.balance?.toLocaleString()),1)]),_:1}),a(g,{prop:"remark",label:"备注","min-width":"200","show-overflow-tooltip":""})]),_:1},8,["data"]),w.value.length===0?(v(),h("div",Et,[a(N,{description:"暂无配额记录"},{default:s(()=>[a(S,{type:"primary",plain:""},{default:s(()=>[...e[11]||(e[11]=[b("申请配额发放",-1)])]),_:1})]),_:1})])):A("",!0)])])),[[B,Q.value]])}}},Nt=I(Vt,[["__scopeId","data-v-7941b5f3"]]);export{Nt as default};
