import{_ as $,r as g,a as R,c as D,b as t,d as s,e as i,w as o,f as n,u as F,o as V,g as P,h as M,n as L,E as w}from"./index-CAroDxw1.js";import{l as S,r as j}from"./user-CvJBtxyD.js";import"./request-xGXa7hEd.js";const A={class:"login-container"},G={class:"login-content"},H={class:"login-title"},J={class:"feature-list"},O={class:"feature-item"},Q={class:"feature-item"},W={class:"feature-item"},X={class:"card-header-tabs"},Y={class:"login-options"},Z={class:"register-footer"},h={__name:"index",setup(ee){const b=F(),p=g(!1),u=g(!0),x=g(!1),v=g(null),_=g(null),d=R({username:"",password:""}),q={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},r=R({username:"",password:"",confirmPassword:""}),E={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:16,message:"长度在 4 到 16 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,validator:(f,e,a)=>{e===""?a(new Error("请再次输入密码")):e!==r.password?a(new Error("两次输入密码不一致!")):a()},trigger:"blur"}]},C=async()=>{v.value&&await v.value.validate(async f=>{if(f){p.value=!0;try{const e=await S(d);e&&e.token?(w.success("登录成功"),localStorage.setItem("token",e.token),localStorage.setItem("username",d.username),b.push("/")):w.error("登录失败，请检查用户名或密码")}catch(e){console.error(e)}finally{p.value=!1}}})},I=async()=>{_.value&&await _.value.validate(async f=>{if(f){p.value=!0;try{const e=await j({username:r.username,password:r.password});if(e&&(e.success||e.code===200||e===null)){w.success("注册成功，正在为您自动登录...");try{const a=await S({username:r.username,password:r.password});a&&a.token?(localStorage.setItem("token",a.token),localStorage.setItem("username",r.username),b.push("/")):(w.warning("自动登录失败，请手动登录"),u.value=!0,d.username=r.username)}catch(a){console.error(a),u.value=!0}}else w.error(e.message||"注册失败")}catch(e){console.error(e)}finally{p.value=!1}}})};return(f,e)=>{const a=n("DataLine"),y=n("el-icon"),B=n("TrendCharts"),z=n("SetUp"),c=n("el-input"),m=n("el-form-item"),K=n("el-checkbox"),k=n("el-button"),U=n("el-form"),N=n("el-link"),T=n("el-card");return V(),D("div",A,[t("div",G,[t("div",H,[e[12]||(e[12]=t("h1",{class:"system-name"},"碳中和",-1)),e[13]||(e[13]=t("h2",{class:"sub-title"},"数字碳资产管理系统",-1)),t("div",J,[t("div",O,[s(y,null,{default:o(()=>[s(a)]),_:1}),e[9]||(e[9]=i(" 全流程碳资产开发管理",-1))]),t("div",Q,[s(y,null,{default:o(()=>[s(B)]),_:1}),e[10]||(e[10]=i(" 实时碳交易行情监控",-1))]),t("div",W,[s(y,null,{default:o(()=>[s(z)]),_:1}),e[11]||(e[11]=i(" 智能配额履约分析",-1))])])]),s(T,{class:"login-card",shadow:"always"},{header:o(()=>[t("div",X,[t("span",{class:L({active:u.value}),onClick:e[0]||(e[0]=l=>u.value=!0)},"用户登录",2),e[14]||(e[14]=t("span",{class:"divider"},"|",-1)),t("span",{class:L({active:!u.value}),onClick:e[1]||(e[1]=l=>u.value=!1)},"注册账号",2)])]),default:o(()=>[u.value?(V(),P(U,{key:0,ref_key:"loginRef",ref:v,model:d,rules:q,"label-width":"0",size:"large"},{default:o(()=>[s(m,{prop:"username"},{default:o(()=>[s(c,{modelValue:d.username,"onUpdate:modelValue":e[2]||(e[2]=l=>d.username=l),"prefix-icon":"User",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),s(m,{prop:"password"},{default:o(()=>[s(c,{modelValue:d.password,"onUpdate:modelValue":e[3]||(e[3]=l=>d.password=l),"prefix-icon":"Lock",type:"password",placeholder:"请输入密码","show-password":"",onKeyup:M(C,["enter"])},null,8,["modelValue"])]),_:1}),s(m,null,{default:o(()=>[t("div",Y,[s(K,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=l=>x.value=l)},{default:o(()=>[...e[15]||(e[15]=[i("记住密码",-1)])]),_:1},8,["modelValue"]),s(k,{link:"",type:"primary"},{default:o(()=>[...e[16]||(e[16]=[i("忘记密码？",-1)])]),_:1})])]),_:1}),s(m,null,{default:o(()=>[s(k,{type:"primary",class:"action-btn",onClick:C,loading:p.value},{default:o(()=>[...e[17]||(e[17]=[i("立即登录",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):(V(),P(U,{key:1,ref_key:"registerRef",ref:_,model:r,rules:E,"label-width":"0",size:"large"},{default:o(()=>[s(m,{prop:"username"},{default:o(()=>[s(c,{modelValue:r.username,"onUpdate:modelValue":e[5]||(e[5]=l=>r.username=l),"prefix-icon":"User",placeholder:"设置用户名 (4-16位)"},null,8,["modelValue"])]),_:1}),s(m,{prop:"password"},{default:o(()=>[s(c,{modelValue:r.password,"onUpdate:modelValue":e[6]||(e[6]=l=>r.password=l),"prefix-icon":"Lock",type:"password",placeholder:"设置密码 (6位以上)","show-password":""},null,8,["modelValue"])]),_:1}),s(m,{prop:"confirmPassword"},{default:o(()=>[s(c,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=l=>r.confirmPassword=l),"prefix-icon":"Key",type:"password",placeholder:"确认密码","show-password":""},null,8,["modelValue"])]),_:1}),s(m,null,{default:o(()=>[s(k,{type:"success",class:"action-btn",onClick:I,loading:p.value},{default:o(()=>[...e[18]||(e[18]=[i("注册并登录",-1)])]),_:1},8,["loading"])]),_:1}),t("div",Z,[e[20]||(e[20]=i(" 已有账号？",-1)),s(N,{type:"primary",onClick:e[8]||(e[8]=l=>u.value=!0)},{default:o(()=>[...e[19]||(e[19]=[i("直接登录",-1)])]),_:1})])]),_:1},8,["model"]))]),_:1})])])}}},te=$(h,[["__scopeId","data-v-2bac814a"]]);export{te as default};
