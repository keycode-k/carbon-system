import{_ as be,a as L,r as m,m as _e,c as x,d as l,w as t,f as d,t as ye,o as g,i as j,x as b,U as Ve,e as r,$ as ke,q as Ce,b as _,h as R,N as A,W,X,v as z,a5 as Ue,a6 as xe,F as he,a7 as Pe,B as Re,E as V,L as ze}from"./index-Dl24hcOp.js";import{g as $e,u as G,a as Ie,b as Fe,d as qe,c as Ne,r as Be,e as Ee}from"./system-DaJnZECp.js";const Le={class:"user-container"},Ae={class:"card-header"},Se={class:"actions"},De={key:0,class:"no-role"},Ke={class:"pagination-container"},Me={class:"role-assign-container"},Te={class:"user-info"},Qe={key:0,class:"role-desc"},je={__name:"user",setup(We){const n=L({username:"",phone:"",status:null,page:1,size:10}),$=m(!1),S=m([]),D=m(0),y=m(!1),I=m(""),k=m(null),s=L({id:void 0,username:"",password:"",nickname:"",email:"",phone:"",status:1}),H={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:20,message:"长度在4到20个字符之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在6到20个字符之间",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},C=m(!1),F=m(null),f=L({userId:null,newPassword:"",confirmPassword:""}),J={newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"长度在6到20个字符之间",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(o,e,u)=>{e!==f.newPassword?u(new Error("两次输入的密码不一致")):u()},trigger:"blur"}]},U=m(!1),q=m({}),K=m([]),h=m([]),v=async()=>{$.value=!0;try{const o=await $e(n);S.value=o.records||[],D.value=o.total||0}catch(o){console.error("获取用户列表失败:",o)}finally{$.value=!1}},P=()=>{n.page=1,v()},O=()=>{n.username="",n.phone="",n.status=null,P()},Y=o=>{n.size=o,v()},Z=o=>{n.page=o,v()},ee=()=>{N(),I.value="新增用户",y.value=!0},le=o=>{N(),I.value="编辑用户",s.id=o.id,s.username=o.username,s.nickname=o.nickname,s.email=o.email,s.phone=o.phone,s.status=o.status,y.value=!0},N=()=>{s.id=void 0,s.username="",s.password="",s.nickname="",s.email="",s.phone="",s.status=1,k.value&&k.value.resetFields()},ae=async()=>{k.value&&await k.value.validate(async o=>{if(o)try{s.id?(await G(s),V.success("修改成功")):(await Ne(s),V.success("新增成功")),y.value=!1,v()}catch(e){console.error("操作失败:",e)}})},te=async o=>{try{await G({id:o.id,status:o.status}),V.success(o.status===1?"用户已启用":"用户已禁用")}catch(e){o.status=o.status===1?0:1,console.error("状态修改失败:",e)}},oe=async o=>{await ze.confirm(`确认删除用户「${o.username}」吗？`,"提示",{type:"warning"});try{await qe(o.id),V.success("删除成功"),v()}catch(e){console.error("删除失败:",e)}},se=o=>{f.userId=o.id,f.newPassword="",f.confirmPassword="",C.value=!0},ne=async()=>{F.value&&await F.value.validate(async o=>{if(o)try{await Be({userId:f.userId,newPassword:f.newPassword}),V.success("密码重置成功"),C.value=!1}catch(e){console.error("密码重置失败:",e)}})},re=async o=>{q.value=o;try{const e=await Ie({page:1,size:1e3});K.value=e.records||[];const u=await Fe(o.id);h.value=u||[],U.value=!0}catch(e){console.error("获取角色信息失败:",e)}},de=async()=>{try{await Ee({userId:q.value.id,roleIds:h.value}),V.success("角色分配成功"),U.value=!1,v()}catch(o){console.error("角色分配失败:",o)}};return _e(()=>{v()}),(o,e)=>{const u=d("el-input"),p=d("el-form-item"),M=d("el-option"),ue=d("el-select"),i=d("el-button"),B=d("el-form"),T=d("el-card"),c=d("el-table-column"),ie=d("el-tag"),pe=d("el-switch"),me=d("el-table"),fe=d("el-pagination"),Q=d("el-radio"),ce=d("el-radio-group"),E=d("el-dialog"),we=d("el-checkbox"),ge=d("el-checkbox-group"),ve=ye("loading");return g(),x("div",Le,[l(T,{class:"search-card",shadow:"never"},{default:t(()=>[l(B,{model:n,ref:"queryRef",inline:!0,"label-width":"70px"},{default:t(()=>[l(p,{label:"用户名",prop:"username"},{default:t(()=>[l(u,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=a=>n.username=a),placeholder:"请输入用户名",clearable:"",style:{width:"200px"},onKeyup:j(P,["enter"])},null,8,["modelValue"])]),_:1}),l(p,{label:"手机号",prop:"phone"},{default:t(()=>[l(u,{modelValue:n.phone,"onUpdate:modelValue":e[1]||(e[1]=a=>n.phone=a),placeholder:"请输入手机号",clearable:"",style:{width:"200px"},onKeyup:j(P,["enter"])},null,8,["modelValue"])]),_:1}),l(p,{label:"状态",prop:"status"},{default:t(()=>[l(ue,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=a=>n.status=a),placeholder:"用户状态",clearable:"",style:{width:"140px"}},{default:t(()=>[l(M,{label:"启用",value:1}),l(M,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:t(()=>[l(i,{type:"primary",icon:b(Ve),onClick:P},{default:t(()=>[...e[20]||(e[20]=[r("搜索",-1)])]),_:1},8,["icon"]),l(i,{icon:b(ke),onClick:O},{default:t(()=>[...e[21]||(e[21]=[r("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l(T,{shadow:"never",class:"table-card"},{header:t(()=>[_("div",Ae,[e[23]||(e[23]=_("span",{class:"title"},"用户列表",-1)),_("div",Se,[l(i,{type:"primary",icon:b(Re),onClick:ee},{default:t(()=>[...e[22]||(e[22]=[r("新增用户",-1)])]),_:1},8,["icon"])])])]),default:t(()=>[Ce((g(),R(me,{data:S.value,stripe:"",border:""},{default:t(()=>[l(c,{type:"index",label:"序号",width:"60",align:"center"}),l(c,{prop:"username",label:"用户名","min-width":"100"}),l(c,{prop:"nickname",label:"昵称","min-width":"100","show-overflow-tooltip":""}),l(c,{prop:"email",label:"邮箱","min-width":"150","show-overflow-tooltip":""}),l(c,{prop:"phone",label:"手机号",width:"120"}),l(c,{label:"角色","min-width":"150"},{default:t(a=>[(g(!0),x(W,null,X(a.row.roles,w=>(g(),R(ie,{key:w.id,class:"role-tag",size:"small",type:"info"},{default:t(()=>[r(z(w.roleName),1)]),_:2},1024))),128)),!a.row.roles||a.row.roles.length===0?(g(),x("span",De,"未分配角色")):A("",!0)]),_:1}),l(c,{prop:"status",label:"状态",width:"80",align:"center"},{default:t(a=>[l(pe,{modelValue:a.row.status,"onUpdate:modelValue":w=>a.row.status=w,"active-value":1,"inactive-value":0,onChange:w=>te(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(c,{prop:"createTime",label:"创建时间",width:"170"}),l(c,{label:"操作",width:"200",align:"center",fixed:"right"},{default:t(a=>[l(i,{link:"",type:"primary",icon:b(Ue),onClick:w=>le(a.row)},{default:t(()=>[...e[24]||(e[24]=[r("编辑",-1)])]),_:1},8,["icon","onClick"]),l(i,{link:"",type:"primary",icon:b(xe),onClick:w=>se(a.row)},{default:t(()=>[...e[25]||(e[25]=[r("重置密码",-1)])]),_:1},8,["icon","onClick"]),l(i,{link:"",type:"primary",icon:b(he),onClick:w=>re(a.row)},{default:t(()=>[...e[26]||(e[26]=[r("分配角色",-1)])]),_:1},8,["icon","onClick"]),l(i,{link:"",type:"danger",icon:b(Pe),onClick:w=>oe(a.row)},{default:t(()=>[...e[27]||(e[27]=[r("删除",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[ve,$.value]]),_("div",Ke,[l(fe,{"current-page":n.page,"onUpdate:currentPage":e[3]||(e[3]=a=>n.page=a),"page-size":n.size,"onUpdate:pageSize":e[4]||(e[4]=a=>n.size=a),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Y,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),_:1}),l(E,{title:I.value,modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=a=>y.value=a),width:"500px","append-to-body":"",onClose:N},{footer:t(()=>[l(i,{onClick:e[11]||(e[11]=a=>y.value=!1)},{default:t(()=>[...e[30]||(e[30]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:ae},{default:t(()=>[...e[31]||(e[31]=[r("确定",-1)])]),_:1})]),default:t(()=>[l(B,{ref_key:"formRef",ref:k,model:s,rules:H,"label-width":"80px"},{default:t(()=>[l(p,{label:"用户名",prop:"username"},{default:t(()=>[l(u,{modelValue:s.username,"onUpdate:modelValue":e[5]||(e[5]=a=>s.username=a),placeholder:"请输入用户名",disabled:s.id!==void 0},null,8,["modelValue","disabled"])]),_:1}),s.id?A("",!0):(g(),R(p,{key:0,label:"密码",prop:"password"},{default:t(()=>[l(u,{modelValue:s.password,"onUpdate:modelValue":e[6]||(e[6]=a=>s.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),l(p,{label:"昵称",prop:"nickname"},{default:t(()=>[l(u,{modelValue:s.nickname,"onUpdate:modelValue":e[7]||(e[7]=a=>s.nickname=a),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(p,{label:"邮箱",prop:"email"},{default:t(()=>[l(u,{modelValue:s.email,"onUpdate:modelValue":e[8]||(e[8]=a=>s.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(p,{label:"手机号",prop:"phone"},{default:t(()=>[l(u,{modelValue:s.phone,"onUpdate:modelValue":e[9]||(e[9]=a=>s.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(p,{label:"状态",prop:"status"},{default:t(()=>[l(ce,{modelValue:s.status,"onUpdate:modelValue":e[10]||(e[10]=a=>s.status=a)},{default:t(()=>[l(Q,{label:1},{default:t(()=>[...e[28]||(e[28]=[r("启用",-1)])]),_:1}),l(Q,{label:0},{default:t(()=>[...e[29]||(e[29]=[r("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(E,{title:"重置密码",modelValue:C.value,"onUpdate:modelValue":e[16]||(e[16]=a=>C.value=a),width:"400px","append-to-body":""},{footer:t(()=>[l(i,{onClick:e[15]||(e[15]=a=>C.value=!1)},{default:t(()=>[...e[32]||(e[32]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:ne},{default:t(()=>[...e[33]||(e[33]=[r("确定",-1)])]),_:1})]),default:t(()=>[l(B,{ref_key:"pwdFormRef",ref:F,model:f,rules:J,"label-width":"80px"},{default:t(()=>[l(p,{label:"新密码",prop:"newPassword"},{default:t(()=>[l(u,{modelValue:f.newPassword,"onUpdate:modelValue":e[13]||(e[13]=a=>f.newPassword=a),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),l(p,{label:"确认密码",prop:"confirmPassword"},{default:t(()=>[l(u,{modelValue:f.confirmPassword,"onUpdate:modelValue":e[14]||(e[14]=a=>f.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(E,{title:"分配角色",modelValue:U.value,"onUpdate:modelValue":e[19]||(e[19]=a=>U.value=a),width:"500px","append-to-body":""},{footer:t(()=>[l(i,{onClick:e[18]||(e[18]=a=>U.value=!1)},{default:t(()=>[...e[35]||(e[35]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:de},{default:t(()=>[...e[36]||(e[36]=[r("确定",-1)])]),_:1})]),default:t(()=>[_("div",Me,[_("p",Te,[e[34]||(e[34]=r("当前用户：",-1)),_("strong",null,z(q.value.username),1)]),l(ge,{modelValue:h.value,"onUpdate:modelValue":e[17]||(e[17]=a=>h.value=a)},{default:t(()=>[(g(!0),x(W,null,X(K.value,a=>(g(),R(we,{key:a.id,label:a.id,disabled:a.status===0},{default:t(()=>[r(z(a.roleName)+" ",1),a.description?(g(),x("span",Qe,"("+z(a.description)+")",1)):A("",!0)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},Je=be(je,[["__scopeId","data-v-2e912c69"]]);export{Je as default};
