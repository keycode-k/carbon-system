import{_ as E,u as O,k as f,r as g,m as Q,c as F,d as t,w as l,f as s,E as h,t as M,o as I,q as R,h as V,e as u,v as d,b as y,x as j,$ as q}from"./index-Dl24hcOp.js";import{e as L}from"./trade-BY624NMh.js";const $={class:"trade-records-container"},G={class:"card-header"},H={style:{color:"#67C23A","font-weight":"bold"}},J={__name:"trade-records",setup(K){const w=O(),i=f(()=>w.userId),_=g(!1),c=g([]),r=g({current:1,size:10,total:0}),x=f(()=>c.value.filter(e=>e.buyerId===i.value).reduce((e,o)=>e+Number(o.tradeAmount),0)),z=f(()=>c.value.filter(e=>e.sellerId===i.value).reduce((e,o)=>e+Number(o.tradeAmount),0)),p=async()=>{try{_.value=!0;const e=await L({userId:i.value,current:r.value.current,size:r.value.size});console.log("交易记录API响应:",e),e&&e.records!==void 0?(c.value=e.records||[],r.value.total=e.total||0,console.log("交易记录数据:",c.value)):(console.error("API返回数据格式错误:",e),h.error("获取交易记录失败：数据格式错误"))}catch(e){console.error("加载交易记录失败，详细错误:",e),console.error("错误响应:",e.response),h.error("加载交易记录失败: "+(e.message||"未知错误"))}finally{_.value=!1}},C=e=>{r.value.size=e,p()},A=e=>{r.value.current=e,p()},D=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-";return Q(()=>{p()}),(e,o)=>{const T=s("el-icon"),S=s("el-button"),n=s("el-table-column"),b=s("el-tag"),N=s("el-table"),k=s("el-pagination"),v=s("el-statistic"),m=s("el-col"),B=s("el-row"),P=s("el-card"),U=M("loading");return I(),F("div",$,[t(P,null,{header:l(()=>[y("div",G,[o[3]||(o[3]=y("span",null,"我的交易记录",-1)),t(S,{type:"primary",onClick:p},{default:l(()=>[t(T,null,{default:l(()=>[t(j(q))]),_:1}),o[2]||(o[2]=u(" 刷新 ",-1))]),_:1})])]),default:l(()=>[R((I(),V(N,{data:c.value,stripe:"",style:{width:"100%"}},{default:l(()=>[t(n,{prop:"id",label:"交易ID",width:"80"}),t(n,{label:"交易类型",width:"100"},{default:l(({row:a})=>[t(b,{type:a.buyerId===i.value?"success":"warning"},{default:l(()=>[u(d(a.buyerId===i.value?"买入":"卖出"),1)]),_:2},1032,["type"])]),_:1}),t(n,{label:"资产类型",width:"100"},{default:l(({row:a})=>[t(b,{type:a.assetType==="QUOTA"?"primary":"success"},{default:l(()=>[u(d(a.assetType==="QUOTA"?"碳配额":"CCER"),1)]),_:2},1032,["type"])]),_:1}),t(n,{prop:"tradePrice",label:"成交单价",width:"120"},{default:l(({row:a})=>[u(" ¥"+d(a.tradePrice.toFixed(2)),1)]),_:1}),t(n,{prop:"tradeQuantity",label:"成交数量",width:"120"},{default:l(({row:a})=>[u(d(a.tradeQuantity.toFixed(2))+" 吨 ",1)]),_:1}),t(n,{prop:"tradeAmount",label:"成交金额",width:"150"},{default:l(({row:a})=>[y("span",H," ¥"+d(a.tradeAmount.toFixed(2)),1)]),_:1}),t(n,{prop:"tradeTime",label:"成交时间",width:"180"},{default:l(({row:a})=>[u(d(D(a.tradeTime)),1)]),_:1}),t(n,{prop:"buyOrderId",label:"买单ID",width:"100"}),t(n,{prop:"sellOrderId",label:"卖单ID",width:"100"}),t(n,{label:"对手方ID",width:"100"},{default:l(({row:a})=>[u(d(a.buyerId===i.value?a.sellerId:a.buyerId),1)]),_:1})]),_:1},8,["data"])),[[U,_.value]]),t(k,{"current-page":r.value.current,"onUpdate:currentPage":o[0]||(o[0]=a=>r.value.current=a),"page-size":r.value.size,"onUpdate:pageSize":o[1]||(o[1]=a=>r.value.size=a),"page-sizes":[10,20,50,100],total:r.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:C,onCurrentChange:A,style:{"margin-top":"20px","justify-content":"center"}},null,8,["current-page","page-size","total"]),t(B,{gutter:20,style:{"margin-top":"20px"}},{default:l(()=>[t(m,{span:8},{default:l(()=>[t(v,{title:"总交易次数",value:r.value.total},null,8,["value"])]),_:1}),t(m,{span:8},{default:l(()=>[t(v,{title:"总买入金额",value:x.value,prefix:"¥",precision:2},null,8,["value"])]),_:1}),t(m,{span:8},{default:l(()=>[t(v,{title:"总卖出金额",value:z.value,prefix:"¥",precision:2},null,8,["value"])]),_:1})]),_:1})]),_:1})])}}},Y=E(J,[["__scopeId","data-v-37ead60b"]]);export{Y as default};
