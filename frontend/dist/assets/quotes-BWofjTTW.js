import{a as ue,b as re,c as de,m as pe}from"./trade-BY624NMh.js";import{_ as fe,u as me,r as d,m as ve,c as N,b as s,d as l,w as a,f as n,q as ce,e as i,v as p,t as _e,h as k,E as _,o as b,x as C,D as ge,n as I,H as ye,N as S,C as be,Z as we,L as H}from"./index-Dl24hcOp.js";const Ue={class:"quotes-container"},Ve={class:"page-header"},Te={class:"filter-card"},ke={class:"table-card"},Ce={class:"table-header"},Pe={class:"table-title"},xe={class:"table-stats"},Ee={class:"stat-item"},De={class:"quote-id"},Qe={class:"quantity-value"},ze={class:"price expect"},qe={key:0,class:"price final"},Be={key:1,class:"no-price"},Ne={class:"time-cell"},Ie={class:"action-buttons"},Se={class:"pagination-wrapper"},Le={class:"quote-info"},$e={class:"info-item"},Ae={class:"info-value"},Oe={class:"info-item"},Ye={class:"info-value price"},Me={class:"info-item"},Ge={class:"info-value"},Re={__name:"quotes",setup(He){const L=me(),P=d(L.userId||1),r=d({type:"",assetType:"",status:"",page:1,size:10}),$=d([]),x=d(0),E=d(!1),w=d(!1),D=d(!1),u=d({userId:L.userId||1,type:"BUY",assetType:"QUOTA",quantity:100,expectPrice:50,validUntil:null,remark:""}),U=d(!1),Q=d(!1),V=d({}),g=d({finalPrice:0}),F=o=>({PENDING:"warning",QUOTED:"primary",ACCEPTED:"success",REJECTED:"danger"})[o]||"info",A=o=>({PENDING:"待报价",QUOTED:"已报价",ACCEPTED:"已接受",REJECTED:"已拒绝"})[o]||o,c=async()=>{E.value=!0;try{const o=await ue(r.value);$.value=o.records,x.value=o.total}catch(o){console.error("加载询报价列表失败:",o),_.error("加载列表失败")}finally{E.value=!1}},J=()=>{r.value={type:"",assetType:"",status:"",page:1,size:10},c()},h=()=>{u.value={userId:P.value,type:"BUY",assetType:"QUOTA",quantity:100,expectPrice:50,validUntil:null,remark:""},w.value=!0},j=async()=>{D.value=!0;try{await de(u.value),_.success("发布成功"),w.value=!1,c()}catch(o){console.error("发布失败:",o),_.error("发布失败")}finally{D.value=!1}},Z=o=>{V.value=o,g.value.finalPrice=o.expectPrice,U.value=!0},K=o=>{H.alert(`<div style="line-height: 1.8">
      <p><strong>询价单号:</strong> #${o.id}</p>
      <p><strong>类型:</strong> ${o.type==="BUY"?"买入":"卖出"}</p>
      <p><strong>资产:</strong> ${o.assetType==="QUOTA"?"碳配额":"碳信用"}</p>
      <p><strong>数量:</strong> ${o.quantity?.toLocaleString()} 吨</p>
      <p><strong>期望价格:</strong> ¥${o.expectPrice}</p>
      <p><strong>最终报价:</strong> ¥${o.finalPrice||"-"}</p>
      <p><strong>状态:</strong> ${A(o.status)}</p>
    </div>`,"询价详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭"})},W=async()=>{if(!g.value.finalPrice||g.value.finalPrice<=0){_.warning("请输入有效的报价");return}Q.value=!0;try{await pe(V.value.id,g.value.finalPrice),_.success("报价成功"),U.value=!1,c()}catch(o){console.error("报价失败:",o),_.error("报价失败")}finally{Q.value=!1}},X=async o=>{try{await H.confirm("确认接受此报价吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await re(o,P.value),_.success("接受成功"),c()}catch(e){e!=="cancel"&&(console.error("接受失败:",e),_.error("接受失败"))}},ee=o=>o?o.replace("T"," ").substring(0,16):"-";return ve(()=>{c()}),(o,e)=>{const m=n("el-button"),y=n("el-option"),z=n("el-select"),f=n("el-form-item"),q=n("el-form"),T=n("el-icon"),v=n("el-table-column"),le=n("el-tag"),te=n("el-table"),ae=n("el-pagination"),O=n("el-radio-button"),Y=n("el-radio-group"),M=n("el-radio"),B=n("el-input-number"),se=n("el-date-picker"),oe=n("el-input"),G=n("el-dialog"),ne=n("el-divider"),ie=_e("loading");return b(),N("div",Ue,[s("div",Ve,[e[17]||(e[17]=s("div",{class:"header-content"},[s("h1",null,"询报价中心"),s("p",null,"发布询价单，获取市场最优报价")],-1)),l(m,{type:"primary",size:"large",icon:"Plus",class:"publish-btn",onClick:h},{default:a(()=>[...e[16]||(e[16]=[i(" 发布询价 ",-1)])]),_:1})]),s("div",Te,[l(q,{inline:!0,model:r.value,class:"filter-form"},{default:a(()=>[l(f,{label:"订单类型"},{default:a(()=>[l(z,{modelValue:r.value.type,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.type=t),placeholder:"全部",clearable:"",class:"filter-select"},{default:a(()=>[l(y,{label:"买入",value:"BUY"}),l(y,{label:"卖出",value:"SELL"})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"资产类型"},{default:a(()=>[l(z,{modelValue:r.value.assetType,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.assetType=t),placeholder:"全部",clearable:"",class:"filter-select"},{default:a(()=>[l(y,{label:"碳配额",value:"QUOTA"}),l(y,{label:"碳信用",value:"CREDIT"})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"状态"},{default:a(()=>[l(z,{modelValue:r.value.status,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.status=t),placeholder:"全部",clearable:"",class:"filter-select"},{default:a(()=>[l(y,{label:"待报价",value:"PENDING"}),l(y,{label:"已报价",value:"QUOTED"}),l(y,{label:"已接受",value:"ACCEPTED"})]),_:1},8,["modelValue"])]),_:1}),l(f,null,{default:a(()=>[l(m,{type:"primary",icon:"Search",onClick:c},{default:a(()=>[...e[18]||(e[18]=[i("查询",-1)])]),_:1}),l(m,{icon:"Refresh",onClick:J},{default:a(()=>[...e[19]||(e[19]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",ke,[s("div",Ce,[s("div",Pe,[l(T,{class:"title-icon"},{default:a(()=>[l(C(ge))]),_:1}),e[20]||(e[20]=s("span",null,"市场询报价单",-1))]),s("div",xe,[s("span",Ee,[e[21]||(e[21]=i("共 ",-1)),s("strong",null,p(x.value),1),e[22]||(e[22]=i(" 条记录",-1))])])]),ce((b(),k(te,{data:$.value,class:"custom-table"},{default:a(()=>[l(v,{prop:"id",label:"询价单号",width:"100"},{default:a(t=>[s("span",De,"#"+p(t.row.id),1)]),_:1}),l(v,{prop:"type",label:"类型",width:"90"},{default:a(t=>[s("div",{class:I(["type-badge",t.row.type==="BUY"?"buy":"sell"])},p(t.row.type==="BUY"?"买入":"卖出"),3)]),_:1}),l(v,{prop:"assetType",label:"资产类型",width:"100"},{default:a(t=>[s("span",{class:I(["asset-type",t.row.assetType==="QUOTA"?"quota":"credit"])},p(t.row.assetType==="QUOTA"?"碳配额":"碳信用"),3)]),_:1}),l(v,{prop:"quantity",label:"数量",width:"120"},{default:a(t=>[s("span",Qe,p(t.row.quantity?.toLocaleString()),1),e[23]||(e[23]=s("span",{class:"quantity-unit"},"吨",-1))]),_:1}),l(v,{prop:"expectPrice",label:"期望价格",width:"120"},{default:a(t=>[s("span",ze,"¥"+p(t.row.expectPrice),1)]),_:1}),l(v,{prop:"finalPrice",label:"最终报价",width:"120"},{default:a(t=>[t.row.finalPrice?(b(),N("span",qe,"¥"+p(t.row.finalPrice),1)):(b(),N("span",Be,"待报价"))]),_:1}),l(v,{prop:"status",label:"状态",width:"100"},{default:a(t=>[l(le,{class:I(["status-tag",F(t.row.status)]),effect:"light"},{default:a(()=>[i(p(A(t.row.status)),1)]),_:2},1032,["class"])]),_:1}),l(v,{prop:"validUntil",label:"有效期至",width:"160"},{default:a(t=>[s("div",Ne,[l(T,null,{default:a(()=>[l(C(ye))]),_:1}),s("span",null,p(t.row.validUntil?ee(t.row.validUntil):"-"),1)])]),_:1}),l(v,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),l(v,{label:"操作",width:"160",fixed:"right"},{default:a(t=>[s("div",Ie,[t.row.status==="PENDING"?(b(),k(m,{key:0,type:"primary",size:"small",round:"",onClick:R=>Z(t.row)},{default:a(()=>[...e[24]||(e[24]=[i(" 报价 ",-1)])]),_:1},8,["onClick"])):S("",!0),t.row.status==="QUOTED"&&t.row.userId===P.value?(b(),k(m,{key:1,type:"success",size:"small",round:"",onClick:R=>X(t.row.id)},{default:a(()=>[...e[25]||(e[25]=[i(" 接受 ",-1)])]),_:1},8,["onClick"])):S("",!0),t.row.status!=="PENDING"?(b(),k(m,{key:2,type:"info",size:"small",text:"",onClick:R=>K(t.row)},{default:a(()=>[...e[26]||(e[26]=[i(" 详情 ",-1)])]),_:1},8,["onClick"])):S("",!0)])]),_:1})]),_:1},8,["data"])),[[ie,E.value]]),s("div",Se,[l(ae,{"current-page":r.value.page,"onUpdate:currentPage":e[3]||(e[3]=t=>r.value.page=t),"page-size":r.value.size,"onUpdate:pageSize":e[4]||(e[4]=t=>r.value.size=t),total:x.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",background:"",onCurrentChange:c,onSizeChange:c},null,8,["current-page","page-size","total"])])]),l(G,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=t=>w.value=t),title:"发布询价单",width:"520px",class:"custom-dialog"},{footer:a(()=>[l(m,{onClick:e[11]||(e[11]=t=>w.value=!1)},{default:a(()=>[...e[33]||(e[33]=[i("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:j,loading:D.value},{default:a(()=>[...e[34]||(e[34]=[i("确认发布",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(q,{model:u.value,"label-width":"100px",class:"publish-form"},{default:a(()=>[l(f,{label:"订单类型"},{default:a(()=>[l(Y,{modelValue:u.value.type,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.type=t),class:"type-radio"},{default:a(()=>[l(O,{value:"BUY"},{default:a(()=>[l(T,null,{default:a(()=>[l(C(be))]),_:1}),e[27]||(e[27]=i(" 买入 ",-1))]),_:1}),l(O,{value:"SELL"},{default:a(()=>[l(T,null,{default:a(()=>[l(C(we))]),_:1}),e[28]||(e[28]=i(" 卖出 ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"资产类型"},{default:a(()=>[l(Y,{modelValue:u.value.assetType,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.assetType=t)},{default:a(()=>[l(M,{value:"QUOTA"},{default:a(()=>[...e[29]||(e[29]=[i("碳配额",-1)])]),_:1}),l(M,{value:"CREDIT"},{default:a(()=>[...e[30]||(e[30]=[i("碳信用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"数量"},{default:a(()=>[l(B,{modelValue:u.value.quantity,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.quantity=t),min:1,max:1e5,class:"full-width"},null,8,["modelValue"]),e[31]||(e[31]=s("span",{class:"unit-label"},"吨",-1))]),_:1}),l(f,{label:"期望价格"},{default:a(()=>[l(B,{modelValue:u.value.expectPrice,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.expectPrice=t),min:.01,precision:2,class:"full-width"},null,8,["modelValue"]),e[32]||(e[32]=s("span",{class:"unit-label"},"元/吨",-1))]),_:1}),l(f,{label:"有效期"},{default:a(()=>[l(se,{modelValue:u.value.validUntil,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.validUntil=t),type:"datetime",placeholder:"选择有效期","value-format":"YYYY-MM-DD HH:mm:ss",class:"full-width"},null,8,["modelValue"])]),_:1}),l(f,{label:"备注"},{default:a(()=>[l(oe,{modelValue:u.value.remark,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.remark=t),type:"textarea",rows:3,maxlength:"500","show-word-limit":"",placeholder:"请输入备注信息（选填）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(G,{modelValue:U.value,"onUpdate:modelValue":e[15]||(e[15]=t=>U.value=t),title:"提交报价",width:"450px",class:"custom-dialog"},{footer:a(()=>[l(m,{onClick:e[14]||(e[14]=t=>U.value=!1)},{default:a(()=>[...e[39]||(e[39]=[i("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:W,loading:Q.value},{default:a(()=>[...e[40]||(e[40]=[i("确认报价",-1)])]),_:1},8,["loading"])]),default:a(()=>[s("div",Le,[s("div",$e,[e[35]||(e[35]=s("span",{class:"info-label"},"询价单号",-1)),s("span",Ae,"#"+p(V.value.id),1)]),s("div",Oe,[e[36]||(e[36]=s("span",{class:"info-label"},"期望价格",-1)),s("span",Ye,"¥"+p(V.value.expectPrice),1)]),s("div",Me,[e[37]||(e[37]=s("span",{class:"info-label"},"数量",-1)),s("span",Ge,p(V.value.quantity?.toLocaleString())+" 吨",1)])]),l(ne),l(q,{model:g.value,"label-width":"100px"},{default:a(()=>[l(f,{label:"我的报价"},{default:a(()=>[l(B,{modelValue:g.value.finalPrice,"onUpdate:modelValue":e[13]||(e[13]=t=>g.value.finalPrice=t),min:.01,precision:2,class:"full-width",size:"large"},null,8,["modelValue"]),e[38]||(e[38]=s("span",{class:"unit-label"},"元/吨",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},he=fe(Re,[["__scopeId","data-v-8a1f78a1"]]);export{he as default};
