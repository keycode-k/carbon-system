import{_ as ee,a as K,r as u,m as le,c as te,d as l,w as t,f as s,t as oe,o as L,e as d,x,U as ae,$ as ne,B as se,q as re,h as ue,v as de,b as ie,L as pe,E as g}from"./index-Dl24hcOp.js";import{a as me,f as fe,h as ce,i as _e,j as ve,k as ge,l as ye}from"./system-DaJnZECp.js";const be={class:"app-container"},ke={style:{"max-height":"400px","overflow-y":"auto"}},Ce={__name:"role",setup(Ve){const r=K({roleName:"",status:null,page:1,size:10}),N=u([]),R=u(0),y=u(!1),_=u(!1),b=u("新增角色"),U=u(null),k=u(!1),n=K({id:null,roleName:"",roleCode:"",description:"",status:1}),q={roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色编码",trigger:"blur"}]},v=u(!1),h=u([]),C=u(null),z=u([]),M=u(null),V=u(!1),m=async()=>{try{y.value=!0;const a=await me(r);a&&a.records&&(N.value=a.records,R.value=a.total)}catch(a){console.error("加载角色列表失败:",a)}finally{y.value=!1}},S=()=>{r.roleName="",r.status=null,r.page=1,m()},j=()=>{b.value="新增角色",n.id=null,n.roleName="",n.roleCode="",n.description="",n.status=1,_.value=!0},A=a=>{b.value="编辑角色",n.id=a.id,n.roleName=a.roleName,n.roleCode=a.roleCode,n.description=a.description,n.status=a.status,_.value=!0},F=async()=>{try{await U.value.validate(),k.value=!0,n.id?(await ve(n.id,n),g.success("更新成功")):(await ge(n),g.success("创建成功")),_.value=!1,m()}catch(a){console.error("提交失败:",a)}finally{k.value=!1}},H=a=>{pe.confirm(`确定要删除角色"${a.roleName}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await _e(a.id),g.success("删除成功"),m()}catch(e){console.error("删除失败:",e)}}).catch(()=>{})},P=async a=>{M.value=a.id;try{const e=await fe();e&&(h.value=e);const p=await ce(a.id);z.value=p||[],v.value=!0}catch(e){console.error("加载菜单失败:",e)}},Q=async()=>{try{V.value=!0;const a=C.value.getCheckedKeys(),e=C.value.getHalfCheckedKeys(),p=[...a,...e];await ye(M.value,p),g.success("分配权限成功"),v.value=!1}catch(a){console.error("分配权限失败:",a)}finally{V.value=!1}};return le(()=>{m()}),(a,e)=>{const p=s("el-input"),f=s("el-form-item"),T=s("el-option"),G=s("el-select"),w=s("el-icon"),i=s("el-button"),B=s("el-form"),D=s("el-card"),c=s("el-table-column"),J=s("el-tag"),O=s("el-table"),W=s("el-pagination"),$=s("el-radio"),X=s("el-radio-group"),E=s("el-dialog"),Y=s("el-tree"),Z=oe("loading");return L(),te("div",be,[l(D,{class:"search-card"},{default:t(()=>[l(B,{inline:!0,model:r},{default:t(()=>[l(f,{label:"角色名称"},{default:t(()=>[l(p,{modelValue:r.roleName,"onUpdate:modelValue":e[0]||(e[0]=o=>r.roleName=o),placeholder:"请输入角色名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(f,{label:"状态"},{default:t(()=>[l(G,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=o=>r.status=o),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:t(()=>[l(T,{label:"启用",value:1}),l(T,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(i,{type:"primary",onClick:m},{default:t(()=>[l(w,null,{default:t(()=>[l(x(ae))]),_:1}),e[12]||(e[12]=d(" 搜索 ",-1))]),_:1}),l(i,{onClick:S},{default:t(()=>[l(w,null,{default:t(()=>[l(x(ne))]),_:1}),e[13]||(e[13]=d(" 重置 ",-1))]),_:1}),l(i,{type:"success",onClick:j},{default:t(()=>[l(w,null,{default:t(()=>[l(x(se))]),_:1}),e[14]||(e[14]=d(" 新增角色 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(D,null,{default:t(()=>[re((L(),ue(O,{data:N.value,border:"",stripe:""},{default:t(()=>[l(c,{prop:"id",label:"角色ID",width:"80"}),l(c,{prop:"roleName",label:"角色名称",width:"150"}),l(c,{prop:"roleCode",label:"角色编码",width:"150"}),l(c,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),l(c,{prop:"status",label:"状态",width:"100"},{default:t(o=>[l(J,{type:o.row.status===1?"success":"danger"},{default:t(()=>[d(de(o.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"createTime",label:"创建时间",width:"170"}),l(c,{label:"操作",width:"250",fixed:"right"},{default:t(o=>[l(i,{link:"",type:"primary",onClick:I=>A(o.row)},{default:t(()=>[...e[15]||(e[15]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(i,{link:"",type:"primary",onClick:I=>P(o.row)},{default:t(()=>[...e[16]||(e[16]=[d("分配权限",-1)])]),_:1},8,["onClick"]),l(i,{link:"",type:"danger",onClick:I=>H(o.row)},{default:t(()=>[...e[17]||(e[17]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,y.value]]),l(W,{"current-page":r.page,"onUpdate:currentPage":e[2]||(e[2]=o=>r.page=o),"page-size":r.size,"onUpdate:pageSize":e[3]||(e[3]=o=>r.size=o),total:R.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px","justify-content":"flex-end"},onCurrentChange:m,onSizeChange:m},null,8,["current-page","page-size","total"])]),_:1}),l(E,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=o=>_.value=o),title:b.value,width:"500px"},{footer:t(()=>[l(i,{onClick:e[8]||(e[8]=o=>_.value=!1)},{default:t(()=>[...e[20]||(e[20]=[d("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:F,loading:k.value},{default:t(()=>[...e[21]||(e[21]=[d("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(B,{ref_key:"formRef",ref:U,model:n,rules:q,"label-width":"100px"},{default:t(()=>[l(f,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(p,{modelValue:n.roleName,"onUpdate:modelValue":e[4]||(e[4]=o=>n.roleName=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(f,{label:"角色编码",prop:"roleCode"},{default:t(()=>[l(p,{modelValue:n.roleCode,"onUpdate:modelValue":e[5]||(e[5]=o=>n.roleCode=o),placeholder:"请输入角色编码",disabled:!!n.id},null,8,["modelValue","disabled"])]),_:1}),l(f,{label:"角色描述",prop:"description"},{default:t(()=>[l(p,{modelValue:n.description,"onUpdate:modelValue":e[6]||(e[6]=o=>n.description=o),type:"textarea",rows:3,placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),l(f,{label:"状态",prop:"status"},{default:t(()=>[l(X,{modelValue:n.status,"onUpdate:modelValue":e[7]||(e[7]=o=>n.status=o)},{default:t(()=>[l($,{value:1},{default:t(()=>[...e[18]||(e[18]=[d("启用",-1)])]),_:1}),l($,{value:0},{default:t(()=>[...e[19]||(e[19]=[d("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(E,{modelValue:v.value,"onUpdate:modelValue":e[11]||(e[11]=o=>v.value=o),title:"分配权限",width:"500px"},{footer:t(()=>[l(i,{onClick:e[10]||(e[10]=o=>v.value=!1)},{default:t(()=>[...e[22]||(e[22]=[d("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:Q,loading:V.value},{default:t(()=>[...e[23]||(e[23]=[d("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[ie("div",ke,[l(Y,{ref_key:"menuTreeRef",ref:C,data:h.value,props:{label:"menuName",children:"children"},"node-key":"id","show-checkbox":"","default-expand-all":"","default-checked-keys":z.value},null,8,["data","default-checked-keys"])])]),_:1},8,["modelValue"])])}}},Ne=ee(Ce,[["__scopeId","data-v-f7837cee"]]);export{Ne as default};
