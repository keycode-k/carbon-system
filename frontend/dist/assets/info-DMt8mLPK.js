import{g as F,u as O,a as R,d as h}from"./user-CvJBtxyD.js";import{l as j,g as G}from"./assets-QRNHCeCq.js";import{_ as H,r as _,a as E,i as J,c as K,d as l,w as t,f as n,o as W,b as o,t as k,e as m,E as b,p as X}from"./index-CAroDxw1.js";import"./request-xGXa7hEd.js";const Y={class:"app-container"},Z={class:"user-header"},$={class:"user-name"},ee={class:"user-tags"},le={class:"user-progress"},te={class:"progress-item"},oe={class:"progress-item"},ae={class:"asset-summary-box"},se={class:"num"},ne={class:"asset-summary-box"},de={class:"num"},re={class:"danger-zone"},ue={__name:"info",setup(ie){const w=_(""),s=E({nickname:"",phone:"",email:"",bio:""}),U=_(0),C=_(0),A=_("basic"),z=_(65),S=_(30),u=E({oldPassword:"",newPassword:"",confirmPassword:""}),Q=async()=>{try{await O(s),b.success("更新成功"),B()}catch{}},D=async()=>{if(u.newPassword!==u.confirmPassword){b.error("两次密码不一致");return}try{await R({username:w.value,oldPassword:u.oldPassword,newPassword:u.newPassword}),b.success("密码修改成功")}catch{}},L=async()=>{try{if(await X.confirm("确定要注销账号吗？此操作不可逆！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),!s.id){b.error("无法获取用户ID");return}await h(s.id),b.success("账户已注销"),localStorage.clear(),window.location.reload()}catch{}},B=async()=>{const d=localStorage.getItem("token");if(d)try{const e=await F(d);if(e){w.value=e.username,s.id=e.id,s.nickname=e.nickname,s.phone=e.phone,s.email=e.email,s.bio=e.bio||"这家伙很懒，什么都没留下";let r=20;e.nickname&&(r+=20),e.phone&&(r+=20),e.email&&(r+=20),e.bio&&(r+=20),S.value=r}}catch(e){console.error(e)}},M=async()=>{try{const d=await j();let e=0;d&&Array.isArray(d)&&(e=d.reduce((f,c)=>f+(c.totalQuota||0),0)),U.value=e;const r=await G();let v=0;const y=r&&Array.isArray(r)?r:r?.data||[];Array.isArray(y)&&(v=y.reduce((f,c)=>f+(c.amount||0),0)),C.value=v}catch(d){console.error("Failed to fetch assets",d)}};return J(()=>{B(),M()}),(d,e)=>{const r=n("el-avatar"),v=n("el-tag"),y=n("el-divider"),f=n("el-progress"),c=n("el-card"),g=n("el-col"),p=n("el-input"),i=n("el-form-item"),V=n("el-button"),I=n("el-form"),x=n("el-tab-pane"),T=n("el-row"),P=n("el-collapse-item"),N=n("el-collapse"),q=n("el-tabs");return W(),K("div",Y,[l(T,{gutter:20},{default:t(()=>[l(g,{span:8},{default:t(()=>[l(c,{class:"box-card",shadow:"hover"},{default:t(()=>[o("div",Z,[l(r,{size:100,src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}),o("h2",$,k(w.value),1),e[11]||(e[11]=o("p",{class:"user-role"},"注册用户",-1)),o("div",ee,[l(v,{size:"small"},{default:t(()=>[...e[9]||(e[9]=[m("普通权限",-1)])]),_:1}),l(v,{size:"small",type:"success",style:{"margin-left":"5px"}},{default:t(()=>[...e[10]||(e[10]=[m("状态正常",-1)])]),_:1})])]),l(y),o("div",le,[o("div",te,[e[12]||(e[12]=o("span",null,"账户安全评分",-1)),l(f,{percentage:z.value,status:"warning"},null,8,["percentage"])]),o("div",oe,[e[13]||(e[13]=o("span",null,"资料完善度",-1)),l(f,{percentage:S.value},null,8,["percentage"])])])]),_:1})]),_:1}),l(g,{span:16},{default:t(()=>[l(c,{shadow:"hover"},{header:t(()=>[...e[14]||(e[14]=[o("div",{class:"card-header"},[o("span",null,"个人资料编辑")],-1)])]),default:t(()=>[l(q,{modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=a=>A.value=a)},{default:t(()=>[l(x,{label:"基本信息",name:"basic"},{default:t(()=>[l(I,{"label-width":"100px",style:{"max-width":"500px","margin-top":"20px"}},{default:t(()=>[l(i,{label:"用户名"},{default:t(()=>[l(p,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),disabled:""},null,8,["modelValue"])]),_:1}),l(i,{label:"昵称"},{default:t(()=>[l(p,{modelValue:s.nickname,"onUpdate:modelValue":e[1]||(e[1]=a=>s.nickname=a),placeholder:"暂无信息"},null,8,["modelValue"])]),_:1}),l(i,{label:"手机号"},{default:t(()=>[l(p,{modelValue:s.phone,"onUpdate:modelValue":e[2]||(e[2]=a=>s.phone=a),placeholder:"暂无信息"},null,8,["modelValue"])]),_:1}),l(i,{label:"邮箱"},{default:t(()=>[l(p,{modelValue:s.email,"onUpdate:modelValue":e[3]||(e[3]=a=>s.email=a),placeholder:"暂无信息"},null,8,["modelValue"])]),_:1}),l(i,{label:"个人简介"},{default:t(()=>[l(p,{modelValue:s.bio,"onUpdate:modelValue":e[4]||(e[4]=a=>s.bio=a),type:"textarea",rows:3,placeholder:"暂无信息"},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(V,{type:"primary",onClick:Q},{default:t(()=>[...e[15]||(e[15]=[m("保存修改",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{label:"资产概览",name:"assets"},{default:t(()=>[l(c,{shadow:"never"},{default:t(()=>[l(T,{gutter:40},{default:t(()=>[l(g,{span:12},{default:t(()=>[o("div",ae,[e[17]||(e[17]=o("h3",null,"持有配额 (Quota)",-1)),o("div",se,[m(k(U.value.toLocaleString())+" ",1),e[16]||(e[16]=o("small",null,"tCO2e",-1))])])]),_:1}),l(g,{span:12},{default:t(()=>[o("div",ne,[e[19]||(e[19]=o("h3",null,"持有信用 (CCER)",-1)),o("div",de,[m(k(C.value.toLocaleString())+" ",1),e[18]||(e[18]=o("small",null,"tCO2e",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{label:"安全设置",name:"security"},{default:t(()=>[l(N,{accordion:""},{default:t(()=>[l(P,{title:"修改密码",name:"1"},{default:t(()=>[l(I,{"label-width":"100px",style:{"max-width":"500px"}},{default:t(()=>[l(i,{label:"旧密码"},{default:t(()=>[l(p,{type:"password",modelValue:u.oldPassword,"onUpdate:modelValue":e[5]||(e[5]=a=>u.oldPassword=a)},null,8,["modelValue"])]),_:1}),l(i,{label:"新密码"},{default:t(()=>[l(p,{type:"password",modelValue:u.newPassword,"onUpdate:modelValue":e[6]||(e[6]=a=>u.newPassword=a)},null,8,["modelValue"])]),_:1}),l(i,{label:"确认密码"},{default:t(()=>[l(p,{type:"password",modelValue:u.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=a=>u.confirmPassword=a)},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(V,{type:"warning",onClick:D},{default:t(()=>[...e[20]||(e[20]=[m("修改密码",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(P,{title:"绑定手机",name:"2"},{default:t(()=>[o("div",null,[e[22]||(e[22]=m("当前未绑定手机 ",-1)),l(V,{type:"primary",link:""},{default:t(()=>[...e[21]||(e[21]=[m("立即绑定",-1)])]),_:1})])]),_:1}),l(P,{title:"注销账户",name:"3"},{default:t(()=>[o("div",re,[e[24]||(e[24]=o("p",null,"注销账户将永久删除您的所有个人信息，且无法恢复。",-1)),l(V,{type:"danger",onClick:L},{default:t(()=>[...e[23]||(e[23]=[m("确认注销账户",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])}}},_e=H(ue,[["__scopeId","data-v-61be87d7"]]);export{_e as default};
