# 快速启动指南

## 📋 前置条件

- ✅ MySQL 8.0+
- ✅ Redis
- ✅ Nacos 2.2.0+
- ✅ JDK 21
- ✅ Maven 3.8+
- ✅ Node.js 18+

---

## 🚀 启动步骤

### 1. 数据库初始化

```bash
# 进入 service-development 模块
cd service-development/src/main/resources

# 执行 init.sql（包含新增的 project_document 表）
mysql -u root -p carbon_development < init.sql
```

### 2. 启动后端服务

#### 方式一：使用 Maven
```bash
# 在项目根目录
cd service-development
mvn spring-boot:run
```

#### 方式二：使用 IDE
- 运行 `DevelopmentApplication.java` 主类
- 默认端口：8083

**验证**：访问 http://localhost:8083/api/development/projects

---

### 3. 启动前端

```bash
cd frontend
npm install  # 首次运行需要安装依赖
npm run dev
```

**访问地址**：http://localhost:5173

---

## 🧪 功能测试

### 1. 用户登录状态管理测试

#### 测试步骤：
1. 访问 http://localhost:5173/login
2. 登录（用户名: admin, 密码: 123456）
3. 打开浏览器控制台 -> Application -> Local Storage
4. 检查是否存储了 `token`

#### 验证点：
- ✅ 登录后跳转到首页
- ✅ localStorage 中存在 token
- ✅ 页面刷新后依然保持登录状态
- ✅ store 中 userId 正确（打开 Vue DevTools 查看）

---

### 2. 文档管理功能测试

#### 测试步骤：
1. 登录后进入"开发工作台"菜单
2. 选择左侧项目列表中的任意项目
3. 向下滚动到"文档上传"区域
4. 点击"点击上传文档"按钮
5. 选择文件（支持 pdf、doc、docx 等）
6. 等待上传完成

#### 验证点：
- ✅ 文件上传成功提示
- ✅ 文档列表自动刷新
- ✅ 新上传的文档显示在列表中
- ✅ 文档信息完整（名称、类型、版本、状态、大小、时间）

#### 测试下载功能：
- 点击文档列表中的"下载"按钮
- 检查是否提示文件路径

#### 测试删除功能：
- 点击"删除"按钮
- 确认提示框
- 检查文档是否从列表中消失

#### 测试版本管理：
- 点击"版本"按钮
- 输入新版本号（如 v1.1）
- 确认创建
- 检查是否创建成功提示

---

### 3. 硬编码userId修复验证

#### 测试页面：
1. **配额管理** (`/assets/quota`)
   - 查看浏览器控制台 Network
   - 检查请求参数中的 userId 是否来自 store

2. **信用管理** (`/assets/credit`)
   - 同上验证

3. **企业信息** (`/account/company`)
   - 同上验证

4. **询报价** (`/market/quotes`)
   - 同上验证

#### 验证方法：
- 打开 Vue DevTools
- 查看 Pinia Store -> user
- 确认 userId 不再是硬编码的 1
- 而是从登录接口返回的真实用户ID

---

## 📝 API 接口清单

### 文档管理接口

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/development/document/upload` | 上传文档 |
| GET | `/api/development/document/list` | 文档列表（分页） |
| GET | `/api/development/document/{id}` | 文档详情 |
| GET | `/api/development/document/download/{id}` | 下载文档 |
| PUT | `/api/development/document/{id}` | 更新文档信息 |
| DELETE | `/api/development/document/{id}` | 删除文档 |
| POST | `/api/development/document/{id}/version` | 创建新版本 |
| GET | `/api/development/document/project/{projectId}` | 按项目查询文档 |

---

## 🐛 常见问题

### 1. 文档上传失败

**问题**：上传文档时提示错误

**解决方案**：
- 检查文件大小（不超过50MB）
- 检查 `uploads/documents/` 目录是否存在且有写权限
- 检查后端日志

### 2. 文档列表为空

**问题**：上传成功但列表中看不到文档

**解决方案**：
- 检查数据库中 `project_document` 表是否有数据
- 检查项目ID是否匹配
- 打开浏览器控制台查看接口返回

### 3. userId 仍然是 1

**问题**：修复后 userId 依然显示为 1

**解决方案**：
- 清除浏览器缓存和 localStorage
- 重新登录
- 检查登录接口是否返回了正确的 userId

### 4. 页面刷新后退出登录

**问题**：刷新页面后需要重新登录

**解决方案**：
- 检查 `main.js` 中是否调用了 `userStore.restoreLoginState()`
- 检查 localStorage 中是否存在 token

---

## 📊 数据库表结构

### project_document 表

```sql
CREATE TABLE `project_document` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `project_id` bigint(20) NOT NULL COMMENT '项目ID',
  `doc_name` varchar(200) NOT NULL COMMENT '文档名称',
  `doc_type` varchar(50) DEFAULT NULL COMMENT '文档类型',
  `file_url` varchar(500) DEFAULT NULL COMMENT '文件URL',
  `file_size` bigint(20) DEFAULT NULL COMMENT '文件大小(bytes)',
  `version` varchar(20) DEFAULT 'v1.0' COMMENT '版本号',
  `upload_user_id` bigint(20) DEFAULT NULL COMMENT '上传人ID',
  `status` varchar(20) DEFAULT 'DRAFT' COMMENT '状态',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_project_id` (`project_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目文档管理表';
```

---

## 🎯 下一步开发

参考 [后续开发计划.md](./后续开发计划.md) 继续开发：

- [ ] 交易撮合引擎优化（Week 2）
- [ ] 角色权限管理（Week 3-4）
- [ ] JWT统一认证（Week 3-4）

---

## 📞 技术支持

遇到问题请查看：
1. [开发进度报告-2026-01-07.md](./开发进度报告-2026-01-07.md)
2. [后续开发计划.md](./后续开发计划.md)
3. 项目日志文件
