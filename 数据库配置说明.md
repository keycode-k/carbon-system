# 数据库配置说明

## 已完成的配置更新

### 1. **MySQL配置** (service-provider)
- 主机: `132.226.64.96:3306`
- 数据库: `test1`
- 用户名: `123456`
- 密码: `123456`

### 2. **Redis配置** (service-provider)
- 主机: `132.226.64.96:6379`
- 密码: `20041122gooder`

### 3. **Nacos配置** (service-provider 和 service-consumer)
- 主机: `132.226.64.96:8848`
- 用户名: `nacos`
- 密码: `nacos`

---

## 数据库初始化步骤

### 方式一：使用MySQL客户端连接执行

```bash
# 连接到MySQL服务器
mysql -h 132.226.64.96 -P 3306 -u 123456 -p
# 输入密码: 123456

# 选择数据库
USE test1;

# 执行建表SQL (复制下面的SQL语句)
CREATE TABLE IF NOT EXISTS `user` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` VARCHAR(50) NOT NULL COMMENT '用户名',
  `password` VARCHAR(100) NOT NULL COMMENT '密码',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';

# 验证表是否创建成功
SHOW TABLES;
DESC user;
```

### 方式二：使用Navicat或其他图形化工具
1. 创建新连接，填入以下信息：
   - 主机: `132.226.64.96`
   - 端口: `3306`
   - 用户名: `123456`
   - 密码: `123456`
   - 数据库: `test1`

2. 连接成功后，在查询窗口执行 `init.sql` 文件中的SQL语句

---

## 已添加的依赖

### service-provider/pom.xml
```xml
<!-- MySQL驱动 -->
<dependency>
    <groupId>com.mysql</groupId>
    <artifactId>mysql-connector-j</artifactId>
</dependency>

<!-- MyBatis-Plus -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.5</version>
</dependency>
```

---

## 主要代码变更

### 1. User实体类增强
- 添加了 `@TableName("user")` 注解
- 添加了 `id`、`createTime`、`updateTime` 字段
- 使用 `@TableId(type = IdType.AUTO)` 标识主键自增

### 2. UserController改造
- 移除了内存Map存储
- 使用 `UserMapper` 操作MySQL数据库
- 注册功能：检查用户名是否存在后插入数据库
- 登录功能：从数据库验证用户名密码

### 3. 新增UserMapper接口
- 继承 `BaseMapper<User>`
- 提供基础的CRUD操作

---

## 启动顺序

1. **启动Nacos服务器** (132.226.64.96:8848 已启动)
2. **启动Redis服务器** (132.226.64.96:6379 已启动)
3. **初始化MySQL数据库表** (执行上述SQL)
4. **启动service-provider** (端口8081)
5. **启动service-consumer** (端口8082)
6. **启动frontend前端** (npm run dev)

---

## 测试连接

启动项目后，观察日志：
- ✅ Nacos连接成功：看到服务注册成功日志
- ✅ Redis连接成功：无连接错误
- ✅ MySQL连接成功：看到MyBatis-Plus初始化日志

如有连接问题，检查：
1. 服务器防火墙是否开放对应端口
2. MySQL、Redis、Nacos服务是否正常运行
3. 用户名密码是否正确
